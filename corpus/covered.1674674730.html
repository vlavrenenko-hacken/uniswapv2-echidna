<style> code { white-space: pre-wrap; display: block; background-color: #eee; } </style><b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/UniswapV2Router02.sol</b>
<code>
   1 |     | <span style='background-color: #faa;'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
   3 |     | <span style='background-color: #eee;'></span>
   4 |     | <span style='background-color: #eee;'>import &#39;./interfaces/IUniswapV2Router02.sol&#39;;</span>
   5 |     | <span style='background-color: #eee;'>import &#39;./libraries/UniswapV2Library.sol&#39;;</span>
   6 |     | <span style='background-color: #eee;'>import &#39;./interfaces/IERC20.sol&#39;;</span>
   7 |     | <span style='background-color: #eee;'>import &#39;./interfaces/IWETH.sol&#39;;</span>
   8 |     | <span style='background-color: #eee;'></span>
   9 |     | <span style='background-color: #eee;'>interface IUniswapV2Factory {</span>
  10 |     | <span style='background-color: #eee;'>    event PairCreated(address indexed token0, address indexed token1, address pair, uint);</span>
  11 |     | <span style='background-color: #eee;'></span>
  12 |     | <span style='background-color: #eee;'>    function feeTo() external view returns (address);</span>
  13 |     | <span style='background-color: #eee;'>    function feeToSetter() external view returns (address);</span>
  14 |     | <span style='background-color: #eee;'></span>
  15 |     | <span style='background-color: #eee;'>    function getPair(address tokenA, address tokenB) external view returns (address pair);</span>
  16 |     | <span style='background-color: #eee;'>    function allPairs(uint) external view returns (address pair);</span>
  17 |     | <span style='background-color: #eee;'>    function allPairsLength() external view returns (uint);</span>
  18 |     | <span style='background-color: #eee;'></span>
  19 |     | <span style='background-color: #eee;'>    function createPair(address tokenA, address tokenB) external returns (address pair);</span>
  20 |     | <span style='background-color: #eee;'></span>
  21 |     | <span style='background-color: #eee;'>    function setFeeTo(address) external;</span>
  22 |     | <span style='background-color: #eee;'>    function setFeeToSetter(address) external;</span>
  23 |     | <span style='background-color: #eee;'>}</span>
  24 |     | <span style='background-color: #faa;'></span>
  25 |     | <span style='background-color: #eee;'>library TransferHelper {</span>
  26 |     | <span style='background-color: #eee;'>    function safeApprove(</span>
  27 |     | <span style='background-color: #eee;'>        address token,</span>
  28 |     | <span style='background-color: #eee;'>        address to,</span>
  29 |     | <span style='background-color: #eee;'>        uint256 value</span>
  30 |     | <span style='background-color: #eee;'>    ) internal {</span>
  31 |     | <span style='background-color: #eee;'>        // bytes4(keccak256(bytes(&#39;approve(address,uint256)&#39;)));</span>
  32 |     | <span style='background-color: #eee;'>        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0x095ea7b3, to, value));</span>
  33 |     | <span style='background-color: #eee;'>        require(</span>
  34 |     | <span style='background-color: #eee;'>            success &amp;&amp; (data.length == 0 || abi.decode(data, (bool))),</span>
  35 |     | <span style='background-color: #eee;'>            &#39;TransferHelper::safeApprove: approve failed&#39;</span>
  36 |     | <span style='background-color: #eee;'>        );</span>
  37 |     | <span style='background-color: #eee;'>    }</span>
  38 |     | <span style='background-color: #eee;'></span>
  39 |     | <span style='background-color: #faa;'>    function safeTransfer(</span>
  40 |     | <span style='background-color: #eee;'>        address token,</span>
  41 |     | <span style='background-color: #eee;'>        address to,</span>
  42 |     | <span style='background-color: #eee;'>        uint256 value</span>
  43 |     | <span style='background-color: #faa;'>    ) internal {</span>
  44 |     | <span style='background-color: #eee;'>        // bytes4(keccak256(bytes(&#39;transfer(address,uint256)&#39;)));</span>
  45 |     | <span style='background-color: #faa;'>        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0xa9059cbb, to, value));</span>
  46 |     | <span style='background-color: #faa;'>        require(</span>
  47 |     | <span style='background-color: #faa;'>            success &amp;&amp; (data.length == 0 || abi.decode(data, (bool))),</span>
  48 |     | <span style='background-color: #eee;'>            &#39;TransferHelper::safeTransfer: transfer failed&#39;</span>
  49 |     | <span style='background-color: #eee;'>        );</span>
  50 |     | <span style='background-color: #eee;'>    }</span>
  51 |     | <span style='background-color: #eee;'></span>
  52 |     | <span style='background-color: #faa;'>    function safeTransferFrom(</span>
  53 |     | <span style='background-color: #eee;'>        address token,</span>
  54 |     | <span style='background-color: #eee;'>        address from,</span>
  55 |     | <span style='background-color: #eee;'>        address to,</span>
  56 |     | <span style='background-color: #eee;'>        uint256 value</span>
  57 |     | <span style='background-color: #faa;'>    ) internal {</span>
  58 |     | <span style='background-color: #eee;'>        // bytes4(keccak256(bytes(&#39;transferFrom(address,address,uint256)&#39;)));</span>
  59 |     | <span style='background-color: #faa;'>        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(0x23b872dd, from, to, value));</span>
  60 |     | <span style='background-color: #faa;'>        require(</span>
  61 |     | <span style='background-color: #faa;'>            success &amp;&amp; (data.length == 0 || abi.decode(data, (bool))),</span>
  62 |     | <span style='background-color: #eee;'>            &#39;TransferHelper::transferFrom: transferFrom failed&#39;</span>
  63 |     | <span style='background-color: #eee;'>        );</span>
  64 |     | <span style='background-color: #eee;'>    }</span>
  65 |     | <span style='background-color: #eee;'></span>
  66 |     | <span style='background-color: #faa;'>    function safeTransferETH(address to, uint256 value) internal {</span>
  67 |     | <span style='background-color: #faa;'>        (bool success, ) = to.call{value: value}(new bytes(0));</span>
  68 |     | <span style='background-color: #faa;'>        require(success, &#39;TransferHelper::safeTransferETH: ETH transfer failed&#39;);</span>
  69 |     | <span style='background-color: #eee;'>    }</span>
  70 |     | <span style='background-color: #eee;'>}</span>
  71 |     | <span style='background-color: #faa;'></span>
  72 |     | <span style='background-color: #eee;'>contract UniswapV2Router02 is IUniswapV2Router02 {</span>
  73 |     | <span style='background-color: #eee;'></span>
  74 |     | <span style='background-color: #faa;'>    address public immutable override factory;</span>
  75 |     | <span style='background-color: #faa;'>    address public immutable override WETH;</span>
  76 |     | <span style='background-color: #eee;'></span>
  77 |     | <span style='background-color: #eee;'>    modifier ensure(uint deadline) {</span>
  78 |     | <span style='background-color: #faa;'>        require(deadline &gt;= block.timestamp, &#39;UniswapV2Router: EXPIRED&#39;);</span>
  79 |     | <span style='background-color: #eee;'>        _;</span>
  80 |     | <span style='background-color: #eee;'>    }</span>
  81 |     | <span style='background-color: #eee;'></span>
  82 |     | <span style='background-color: #faa;'>    constructor(address _factory, address _WETH) {</span>
  83 |     | <span style='background-color: #faa;'>        factory = _factory;</span>
  84 |     | <span style='background-color: #faa;'>        WETH = _WETH;</span>
  85 |     | <span style='background-color: #eee;'>    }</span>
  86 |     | <span style='background-color: #eee;'></span>
  87 |     | <span style='background-color: #eee;'>    receive() external payable {</span>
  88 |     | <span style='background-color: #faa;'>        assert(msg.sender == WETH); // only accept ETH via fallback from the WETH contract</span>
  89 |     | <span style='background-color: #eee;'>    }</span>
  90 |     | <span style='background-color: #eee;'></span>
  91 |     | <span style='background-color: #eee;'>    // **** ADD LIQUIDITY ****</span>
  92 |     | <span style='background-color: #faa;'>    function _addLiquidity(</span>
  93 |     | <span style='background-color: #eee;'>        address tokenA,</span>
  94 |     | <span style='background-color: #eee;'>        address tokenB,</span>
  95 |     | <span style='background-color: #eee;'>        uint amountADesired,</span>
  96 |     | <span style='background-color: #eee;'>        uint amountBDesired,</span>
  97 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
  98 |     | <span style='background-color: #eee;'>        uint amountBMin</span>
  99 |     | <span style='background-color: #faa;'>    ) internal virtual returns (uint amountA, uint amountB) {</span>
 100 |     | <span style='background-color: #eee;'>        // create the pair if it doesn&#39;t exist yet</span>
 101 |     | <span style='background-color: #faa;'>        if (IUniswapV2Factory(factory).getPair(tokenA, tokenB) == address(0)) {</span>
 102 |     | <span style='background-color: #faa;'>            IUniswapV2Factory(factory).createPair(tokenA, tokenB);</span>
 103 |     | <span style='background-color: #eee;'>        }</span>
 104 |     | <span style='background-color: #faa;'>        (uint reserveA, uint reserveB) = UniswapV2Library.getReserves(factory, tokenA, tokenB);</span>
 105 |     | <span style='background-color: #faa;'>        if (reserveA == 0 &amp;&amp; reserveB == 0) {</span>
 106 |     | <span style='background-color: #faa;'>            (amountA, amountB) = (amountADesired, amountBDesired);</span>
 107 |     | <span style='background-color: #faa;'>        } else {</span>
 108 |     | <span style='background-color: #faa;'>            uint amountBOptimal = UniswapV2Library.quote(amountADesired, reserveA, reserveB);</span>
 109 |     | <span style='background-color: #faa;'>            if (amountBOptimal &lt;= amountBDesired) {</span>
 110 |     | <span style='background-color: #faa;'>                require(amountBOptimal &gt;= amountBMin, &#39;UniswapV2Router: INSUFFICIENT_B_AMOUNT&#39;);</span>
 111 |     | <span style='background-color: #faa;'>                (amountA, amountB) = (amountADesired, amountBOptimal);</span>
 112 |     | <span style='background-color: #faa;'>            } else {</span>
 113 |     | <span style='background-color: #faa;'>                uint amountAOptimal = UniswapV2Library.quote(amountBDesired, reserveB, reserveA);</span>
 114 |     | <span style='background-color: #faa;'>                assert(amountAOptimal &lt;= amountADesired);</span>
 115 |     | <span style='background-color: #faa;'>                require(amountAOptimal &gt;= amountAMin, &#39;UniswapV2Router: INSUFFICIENT_A_AMOUNT&#39;);</span>
 116 |     | <span style='background-color: #faa;'>                (amountA, amountB) = (amountAOptimal, amountBDesired);</span>
 117 |     | <span style='background-color: #eee;'>            }</span>
 118 |     | <span style='background-color: #eee;'>        }</span>
 119 |     | <span style='background-color: #eee;'>    }</span>
 120 |     | <span style='background-color: #faa;'>    function addLiquidity(</span>
 121 |     | <span style='background-color: #eee;'>        address tokenA,</span>
 122 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 123 |     | <span style='background-color: #eee;'>        uint amountADesired,</span>
 124 |     | <span style='background-color: #eee;'>        uint amountBDesired,</span>
 125 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 126 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 127 |     | <span style='background-color: #eee;'>        address to,</span>
 128 |     | <span style='background-color: #eee;'>        uint deadline</span>
 129 |     | <span style='background-color: #faa;'>    ) external virtual override ensure(deadline) returns (uint amountA, uint amountB, uint liquidity) {</span>
 130 |     | <span style='background-color: #faa;'>        (amountA, amountB) = _addLiquidity(tokenA, tokenB, amountADesired, amountBDesired, amountAMin, amountBMin);</span>
 131 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);</span>
 132 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(tokenA, msg.sender, pair, amountA);</span>
 133 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(tokenB, msg.sender, pair, amountB);</span>
 134 |     | <span style='background-color: #faa;'>        liquidity = IUniswapV2Pair(pair).mint(to);</span>
 135 |     | <span style='background-color: #eee;'>    }</span>
 136 |     | <span style='background-color: #faa;'>    function addLiquidityETH(</span>
 137 |     | <span style='background-color: #eee;'>        address token,</span>
 138 |     | <span style='background-color: #eee;'>        uint amountTokenDesired,</span>
 139 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 140 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 141 |     | <span style='background-color: #eee;'>        address to,</span>
 142 |     | <span style='background-color: #eee;'>        uint deadline</span>
 143 |     | <span style='background-color: #faa;'>    ) external virtual override payable ensure(deadline) returns (uint amountToken, uint amountETH, uint liquidity) {</span>
 144 |     | <span style='background-color: #faa;'>        (amountToken, amountETH) = _addLiquidity(</span>
 145 |     | <span style='background-color: #faa;'>            token,</span>
 146 |     | <span style='background-color: #faa;'>            WETH,</span>
 147 |     | <span style='background-color: #faa;'>            amountTokenDesired,</span>
 148 |     | <span style='background-color: #faa;'>            msg.value,</span>
 149 |     | <span style='background-color: #faa;'>            amountTokenMin,</span>
 150 |     | <span style='background-color: #faa;'>            amountETHMin</span>
 151 |     | <span style='background-color: #eee;'>        );</span>
 152 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, token, WETH);</span>
 153 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(token, msg.sender, pair, amountToken);</span>
 154 |     | <span style='background-color: #faa;'>        IWETH(WETH).deposit{value: amountETH}();</span>
 155 |     | <span style='background-color: #faa;'>        assert(IWETH(WETH).transfer(pair, amountETH));</span>
 156 |     | <span style='background-color: #faa;'>        liquidity = IUniswapV2Pair(pair).mint(to);</span>
 157 |     | <span style='background-color: #eee;'>        // refund dust eth, if any</span>
 158 |     | <span style='background-color: #faa;'>        if (msg.value &gt; amountETH) TransferHelper.safeTransferETH(msg.sender, msg.value - amountETH);</span>
 159 |     | <span style='background-color: #eee;'>    }</span>
 160 |     | <span style='background-color: #eee;'></span>
 161 |     | <span style='background-color: #eee;'>    // **** REMOVE LIQUIDITY ****</span>
 162 |     | <span style='background-color: #faa;'>    function removeLiquidity(</span>
 163 |     | <span style='background-color: #eee;'>        address tokenA,</span>
 164 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 165 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 166 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 167 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 168 |     | <span style='background-color: #eee;'>        address to,</span>
 169 |     | <span style='background-color: #eee;'>        uint deadline</span>
 170 |     | <span style='background-color: #faa;'>    ) public virtual override ensure(deadline) returns (uint amountA, uint amountB) {</span>
 171 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);</span>
 172 |     | <span style='background-color: #faa;'>        IUniswapV2Pair(pair).transferFrom(msg.sender, pair, liquidity); // send liquidity to pair</span>
 173 |     | <span style='background-color: #faa;'>        (uint amount0, uint amount1) = IUniswapV2Pair(pair).burn(to);</span>
 174 |     | <span style='background-color: #faa;'>        (address token0,) = UniswapV2Library.sortTokens(tokenA, tokenB);</span>
 175 |     | <span style='background-color: #faa;'>        (amountA, amountB) = tokenA == token0 ? (amount0, amount1) : (amount1, amount0);</span>
 176 |     | <span style='background-color: #faa;'>        require(amountA &gt;= amountAMin, &#39;UniswapV2Router: INSUFFICIENT_A_AMOUNT&#39;);</span>
 177 |     | <span style='background-color: #faa;'>        require(amountB &gt;= amountBMin, &#39;UniswapV2Router: INSUFFICIENT_B_AMOUNT&#39;);</span>
 178 |     | <span style='background-color: #eee;'>    }</span>
 179 |     | <span style='background-color: #faa;'>    function removeLiquidityETH(</span>
 180 |     | <span style='background-color: #eee;'>        address token,</span>
 181 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 182 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 183 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 184 |     | <span style='background-color: #eee;'>        address to,</span>
 185 |     | <span style='background-color: #eee;'>        uint deadline</span>
 186 |     | <span style='background-color: #faa;'>    ) public virtual override ensure(deadline) returns (uint amountToken, uint amountETH) {</span>
 187 |     | <span style='background-color: #faa;'>        (amountToken, amountETH) = removeLiquidity(</span>
 188 |     | <span style='background-color: #faa;'>            token,</span>
 189 |     | <span style='background-color: #faa;'>            WETH,</span>
 190 |     | <span style='background-color: #faa;'>            liquidity,</span>
 191 |     | <span style='background-color: #faa;'>            amountTokenMin,</span>
 192 |     | <span style='background-color: #faa;'>            amountETHMin,</span>
 193 |     | <span style='background-color: #faa;'>            address(this),</span>
 194 |     | <span style='background-color: #faa;'>            deadline</span>
 195 |     | <span style='background-color: #eee;'>        );</span>
 196 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransfer(token, to, amountToken);</span>
 197 |     | <span style='background-color: #faa;'>        IWETH(WETH).withdraw(amountETH);</span>
 198 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferETH(to, amountETH);</span>
 199 |     | <span style='background-color: #eee;'>    }</span>
 200 |     | <span style='background-color: #faa;'>    function removeLiquidityWithPermit(</span>
 201 |     | <span style='background-color: #eee;'>        address tokenA,</span>
 202 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 203 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 204 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 205 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 206 |     | <span style='background-color: #eee;'>        address to,</span>
 207 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 208 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 209 |     | <span style='background-color: #faa;'>    ) external virtual override returns (uint amountA, uint amountB) {</span>
 210 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);</span>
 211 |     | <span style='background-color: #faa;'>        uint value = approveMax ? ~uint(0) : liquidity;</span>
 212 |     | <span style='background-color: #faa;'>        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);</span>
 213 |     | <span style='background-color: #faa;'>        (amountA, amountB) = removeLiquidity(tokenA, tokenB, liquidity, amountAMin, amountBMin, to, deadline);</span>
 214 |     | <span style='background-color: #eee;'>    }</span>
 215 |     | <span style='background-color: #faa;'>    function removeLiquidityETHWithPermit(</span>
 216 |     | <span style='background-color: #eee;'>        address token,</span>
 217 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 218 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 219 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 220 |     | <span style='background-color: #eee;'>        address to,</span>
 221 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 222 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 223 |     | <span style='background-color: #faa;'>    ) external virtual override returns (uint amountToken, uint amountETH) {</span>
 224 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, token, WETH);</span>
 225 |     | <span style='background-color: #faa;'>        uint value = approveMax ? ~uint(0) : liquidity;</span>
 226 |     | <span style='background-color: #faa;'>        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);</span>
 227 |     | <span style='background-color: #faa;'>        (amountToken, amountETH) = removeLiquidityETH(token, liquidity, amountTokenMin, amountETHMin, to, deadline);</span>
 228 |     | <span style='background-color: #eee;'>    }</span>
 229 |     | <span style='background-color: #eee;'></span>
 230 |     | <span style='background-color: #eee;'>    // **** REMOVE LIQUIDITY (supporting fee-on-transfer tokens) ****</span>
 231 |     | <span style='background-color: #faa;'>    function removeLiquidityETHSupportingFeeOnTransferTokens(</span>
 232 |     | <span style='background-color: #eee;'>        address token,</span>
 233 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 234 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 235 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 236 |     | <span style='background-color: #eee;'>        address to,</span>
 237 |     | <span style='background-color: #eee;'>        uint deadline</span>
 238 |     | <span style='background-color: #faa;'>    ) public virtual override ensure(deadline) returns (uint amountETH) {</span>
 239 |     | <span style='background-color: #faa;'>        (, amountETH) = removeLiquidity(</span>
 240 |     | <span style='background-color: #faa;'>            token,</span>
 241 |     | <span style='background-color: #faa;'>            WETH,</span>
 242 |     | <span style='background-color: #faa;'>            liquidity,</span>
 243 |     | <span style='background-color: #faa;'>            amountTokenMin,</span>
 244 |     | <span style='background-color: #faa;'>            amountETHMin,</span>
 245 |     | <span style='background-color: #faa;'>            address(this),</span>
 246 |     | <span style='background-color: #faa;'>            deadline</span>
 247 |     | <span style='background-color: #eee;'>        );</span>
 248 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransfer(token, to, IERC20(token).balanceOf(address(this)));</span>
 249 |     | <span style='background-color: #faa;'>        IWETH(WETH).withdraw(amountETH);</span>
 250 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferETH(to, amountETH);</span>
 251 |     | <span style='background-color: #eee;'>    }</span>
 252 |     | <span style='background-color: #faa;'>    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(</span>
 253 |     | <span style='background-color: #eee;'>        address token,</span>
 254 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 255 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 256 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 257 |     | <span style='background-color: #eee;'>        address to,</span>
 258 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 259 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 260 |     | <span style='background-color: #faa;'>    ) external virtual override returns (uint amountETH) {</span>
 261 |     | <span style='background-color: #faa;'>        address pair = UniswapV2Library.pairFor(factory, token, WETH);</span>
 262 |     | <span style='background-color: #faa;'>        uint value = approveMax ? ~uint(0) : liquidity;</span>
 263 |     | <span style='background-color: #faa;'>        IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);</span>
 264 |     | <span style='background-color: #faa;'>        amountETH = removeLiquidityETHSupportingFeeOnTransferTokens(</span>
 265 |     | <span style='background-color: #faa;'>            token, liquidity, amountTokenMin, amountETHMin, to, deadline</span>
 266 |     | <span style='background-color: #eee;'>        );</span>
 267 |     | <span style='background-color: #eee;'>    }</span>
 268 |     | <span style='background-color: #eee;'></span>
 269 |     | <span style='background-color: #eee;'>    // **** SWAP ****</span>
 270 |     | <span style='background-color: #eee;'>    // requires the initial amount to have already been sent to the first pair</span>
 271 |     | <span style='background-color: #faa;'>    function _swap(uint[] memory amounts, address[] memory path, address _to) internal virtual {</span>
 272 |     | <span style='background-color: #faa;'>        for (uint i; i &lt; path.length - 1; i++) {</span>
 273 |     | <span style='background-color: #faa;'>            (address input, address output) = (path[i], path[i + 1]);</span>
 274 |     | <span style='background-color: #faa;'>            (address token0,) = UniswapV2Library.sortTokens(input, output);</span>
 275 |     | <span style='background-color: #faa;'>            uint amountOut = amounts[i + 1];</span>
 276 |     | <span style='background-color: #faa;'>            (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOut) : (amountOut, uint(0));</span>
 277 |     | <span style='background-color: #faa;'>            address to = i &lt; path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;</span>
 278 |     | <span style='background-color: #faa;'>            IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output)).swap(</span>
 279 |     | <span style='background-color: #faa;'>                amount0Out, amount1Out, to, new bytes(0)</span>
 280 |     | <span style='background-color: #eee;'>            );</span>
 281 |     | <span style='background-color: #eee;'>        }</span>
 282 |     | <span style='background-color: #eee;'>    }</span>
 283 |     | <span style='background-color: #faa;'>    function swapExactTokensForTokens(</span>
 284 |     | <span style='background-color: #eee;'>        uint amountIn,</span>
 285 |     | <span style='background-color: #eee;'>        uint amountOutMin,</span>
 286 |     | <span style='background-color: #eee;'>        address[] calldata path,</span>
 287 |     | <span style='background-color: #eee;'>        address to,</span>
 288 |     | <span style='background-color: #eee;'>        uint deadline</span>
 289 |     | <span style='background-color: #faa;'>    ) external virtual override ensure(deadline) returns (uint[] memory amounts) {</span>
 290 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);</span>
 291 |     | <span style='background-color: #faa;'>        require(amounts[amounts.length - 1] &gt;= amountOutMin, &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 292 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(</span>
 293 |     | <span style='background-color: #faa;'>            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]</span>
 294 |     | <span style='background-color: #eee;'>        );</span>
 295 |     | <span style='background-color: #faa;'>        _swap(amounts, path, to);</span>
 296 |     | <span style='background-color: #eee;'>    }</span>
 297 |     | <span style='background-color: #faa;'>    function swapTokensForExactTokens(</span>
 298 |     | <span style='background-color: #eee;'>        uint amountOut,</span>
 299 |     | <span style='background-color: #eee;'>        uint amountInMax,</span>
 300 |     | <span style='background-color: #eee;'>        address[] calldata path,</span>
 301 |     | <span style='background-color: #eee;'>        address to,</span>
 302 |     | <span style='background-color: #eee;'>        uint deadline</span>
 303 |     | <span style='background-color: #faa;'>    ) external virtual override ensure(deadline) returns (uint[] memory amounts) {</span>
 304 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);</span>
 305 |     | <span style='background-color: #faa;'>        require(amounts[0] &lt;= amountInMax, &#39;UniswapV2Router: EXCESSIVE_INPUT_AMOUNT&#39;);</span>
 306 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(</span>
 307 |     | <span style='background-color: #faa;'>            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]</span>
 308 |     | <span style='background-color: #eee;'>        );</span>
 309 |     | <span style='background-color: #faa;'>        _swap(amounts, path, to);</span>
 310 |     | <span style='background-color: #eee;'>    }</span>
 311 |     | <span style='background-color: #faa;'>    function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
 312 |     | <span style='background-color: #eee;'>        external</span>
 313 |     | <span style='background-color: #eee;'>        virtual</span>
 314 |     | <span style='background-color: #eee;'>        override</span>
 315 |     | <span style='background-color: #eee;'>        payable</span>
 316 |     | <span style='background-color: #faa;'>        ensure(deadline)</span>
 317 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 318 |     | <span style='background-color: #eee;'>    {</span>
 319 |     | <span style='background-color: #faa;'>        require(path[0] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 320 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsOut(factory, msg.value, path);</span>
 321 |     | <span style='background-color: #faa;'>        require(amounts[amounts.length - 1] &gt;= amountOutMin, &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 322 |     | <span style='background-color: #faa;'>        IWETH(WETH).deposit{value: amounts[0]}();</span>
 323 |     | <span style='background-color: #faa;'>        assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));</span>
 324 |     | <span style='background-color: #faa;'>        _swap(amounts, path, to);</span>
 325 |     | <span style='background-color: #eee;'>    }</span>
 326 |     | <span style='background-color: #faa;'>    function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)</span>
 327 |     | <span style='background-color: #eee;'>        external</span>
 328 |     | <span style='background-color: #eee;'>        virtual</span>
 329 |     | <span style='background-color: #eee;'>        override</span>
 330 |     | <span style='background-color: #faa;'>        ensure(deadline)</span>
 331 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 332 |     | <span style='background-color: #eee;'>    {</span>
 333 |     | <span style='background-color: #faa;'>        require(path[path.length - 1] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 334 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);</span>
 335 |     | <span style='background-color: #faa;'>        require(amounts[0] &lt;= amountInMax, &#39;UniswapV2Router: EXCESSIVE_INPUT_AMOUNT&#39;);</span>
 336 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(</span>
 337 |     | <span style='background-color: #faa;'>            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]</span>
 338 |     | <span style='background-color: #eee;'>        );</span>
 339 |     | <span style='background-color: #faa;'>        _swap(amounts, path, address(this));</span>
 340 |     | <span style='background-color: #faa;'>        IWETH(WETH).withdraw(amounts[amounts.length - 1]);</span>
 341 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);</span>
 342 |     | <span style='background-color: #eee;'>    }</span>
 343 |     | <span style='background-color: #faa;'>    function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
 344 |     | <span style='background-color: #eee;'>        external</span>
 345 |     | <span style='background-color: #eee;'>        virtual</span>
 346 |     | <span style='background-color: #eee;'>        override</span>
 347 |     | <span style='background-color: #faa;'>        ensure(deadline)</span>
 348 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 349 |     | <span style='background-color: #eee;'>    {</span>
 350 |     | <span style='background-color: #faa;'>        require(path[path.length - 1] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 351 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);</span>
 352 |     | <span style='background-color: #faa;'>        require(amounts[amounts.length - 1] &gt;= amountOutMin, &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 353 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferFrom(</span>
 354 |     | <span style='background-color: #faa;'>            path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]</span>
 355 |     | <span style='background-color: #eee;'>        );</span>
 356 |     | <span style='background-color: #faa;'>        _swap(amounts, path, address(this));</span>
 357 |     | <span style='background-color: #faa;'>        IWETH(WETH).withdraw(amounts[amounts.length - 1]);</span>
 358 |     | <span style='background-color: #faa;'>        TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);</span>
 359 |     | <span style='background-color: #eee;'>    }</span>
 360 |     | <span style='background-color: #faa;'>    function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)</span>
 361 |     | <span style='background-color: #eee;'>        external</span>
 362 |     | <span style='background-color: #eee;'>        virtual</span>
 363 |     | <span style='background-color: #eee;'>        override</span>
 364 |     | <span style='background-color: #eee;'>        payable</span>
 365 |     | <span style='background-color: #faa;'>        ensure(deadline)</span>
 366 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 367 |     | <span style='background-color: #eee;'>    {</span>
 368 |     | <span style='background-color: #faa;'>        require(path[0] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 369 |     | <span style='background-color: #faa;'>        amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);</span>
 370 |     | <span style='background-color: #faa;'>        require(amounts[0] &lt;= msg.value, &#39;UniswapV2Router: EXCESSIVE_INPUT_AMOUNT&#39;);</span>
 371 |     | <span style='background-color: #faa;'>        IWETH(WETH).deposit{value: amounts[0]}();</span>
 372 |     | <span style='background-color: #faa;'>        assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));</span>
 373 |     | <span style='background-color: #faa;'>        _swap(amounts, path, to);</span>
 374 |     | <span style='background-color: #eee;'>        // refund dust eth, if any</span>
 375 |     | <span style='background-color: #faa;'>        if (msg.value &gt; amounts[0]) TransferHelper.safeTransferETH(msg.sender, msg.value - amounts[0]);</span>
 376 |     | <span style='background-color: #eee;'>    }</span>
 377 |     | <span style='background-color: #eee;'></span>
 378 |     | <span style='background-color: #eee;'>    // **** SWAP (supporting fee-on-transfer tokens) ****</span>
 379 |     | <span style='background-color: #eee;'>    // requires the initial amount to have already been sent to the first pair</span>
 380 |     | <span style='background-color: #eee;'>    // function _swapSupportingFeeOnTransferTokens(address[] memory path, address _to) internal virtual {</span>
 381 |     | <span style='background-color: #eee;'>    //     for (uint i; i &lt; path.length - 1; i++) {</span>
 382 |     | <span style='background-color: #eee;'>    //         (address input, address output) = (path[i], path[i + 1]);</span>
 383 |     | <span style='background-color: #eee;'>    //         (address token0,) = UniswapV2Library.sortTokens(input, output);</span>
 384 |     | <span style='background-color: #eee;'>    //         IUniswapV2Pair pair = IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output));</span>
 385 |     | <span style='background-color: #eee;'>    //         uint amountInput;</span>
 386 |     | <span style='background-color: #eee;'>    //         uint amountOutput;</span>
 387 |     | <span style='background-color: #eee;'>    //         { // scope to avoid stack too deep errors</span>
 388 |     | <span style='background-color: #eee;'>    //         (uint reserve0, uint reserve1,) = pair.getReserves();</span>
 389 |     | <span style='background-color: #eee;'>    //         (uint reserveInput, uint reserveOutput) = input == token0 ? (reserve0, reserve1) : (reserve1, reserve0);</span>
 390 |     | <span style='background-color: #eee;'>    //         amountInput = IERC20(input).balanceOf(address(pair)) - reserveInput;</span>
 391 |     | <span style='background-color: #eee;'>    //         amountOutput = UniswapV2Library.getAmountOut(amountInput, reserveInput, reserveOutput);</span>
 392 |     | <span style='background-color: #eee;'>    //         }</span>
 393 |     | <span style='background-color: #eee;'>    //         (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOutput) : (amountOutput, uint(0));</span>
 394 |     | <span style='background-color: #eee;'>    //         address to = i &lt; path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;</span>
 395 |     | <span style='background-color: #eee;'>    //         pair.swap(amount0Out, amount1Out, to, new bytes(0));</span>
 396 |     | <span style='background-color: #eee;'>    //     }</span>
 397 |     | <span style='background-color: #eee;'>    // }</span>
 398 |     | <span style='background-color: #eee;'>    // function swapExactTokensForTokensSupportingFeeOnTransferTokens(</span>
 399 |     | <span style='background-color: #eee;'>    //     uint amountIn,</span>
 400 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 401 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 402 |     | <span style='background-color: #eee;'>    //     address to,</span>
 403 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 404 |     | <span style='background-color: #eee;'>    // ) external virtual override ensure(deadline) {</span>
 405 |     | <span style='background-color: #eee;'>    //     TransferHelper.safeTransferFrom(</span>
 406 |     | <span style='background-color: #eee;'>    //         path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn</span>
 407 |     | <span style='background-color: #eee;'>    //     );</span>
 408 |     | <span style='background-color: #eee;'>    //     uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);</span>
 409 |     | <span style='background-color: #eee;'>    //     _swapSupportingFeeOnTransferTokens(path, to);</span>
 410 |     | <span style='background-color: #eee;'>    //     require(</span>
 411 |     | <span style='background-color: #eee;'>    //         IERC20(path[path.length - 1]).balanceOf(to) - balanceBefore &gt;= amountOutMin,</span>
 412 |     | <span style='background-color: #eee;'>    //         &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;</span>
 413 |     | <span style='background-color: #eee;'>    //     );</span>
 414 |     | <span style='background-color: #eee;'>    // }</span>
 415 |     | <span style='background-color: #eee;'>    // function swapExactETHForTokensSupportingFeeOnTransferTokens(</span>
 416 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 417 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 418 |     | <span style='background-color: #eee;'>    //     address to,</span>
 419 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 420 |     | <span style='background-color: #eee;'>    // )</span>
 421 |     | <span style='background-color: #eee;'>    //     external</span>
 422 |     | <span style='background-color: #eee;'>    //     virtual</span>
 423 |     | <span style='background-color: #eee;'>    //     override</span>
 424 |     | <span style='background-color: #eee;'>    //     payable</span>
 425 |     | <span style='background-color: #eee;'>    //     ensure(deadline)</span>
 426 |     | <span style='background-color: #eee;'>    // {</span>
 427 |     | <span style='background-color: #eee;'>    //     require(path[0] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 428 |     | <span style='background-color: #eee;'>    //     uint amountIn = msg.value;</span>
 429 |     | <span style='background-color: #eee;'>    //     IWETH(WETH).deposit{value: amountIn}();</span>
 430 |     | <span style='background-color: #eee;'>    //     assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn));</span>
 431 |     | <span style='background-color: #eee;'>    //     uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);</span>
 432 |     | <span style='background-color: #eee;'>    //     _swapSupportingFeeOnTransferTokens(path, to);</span>
 433 |     | <span style='background-color: #eee;'>    //     require(</span>
 434 |     | <span style='background-color: #eee;'>    //         IERC20(path[path.length - 1]).balanceOf(to) - balanceBefore &gt;= amountOutMin,</span>
 435 |     | <span style='background-color: #eee;'>    //         &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;</span>
 436 |     | <span style='background-color: #eee;'>    //     );</span>
 437 |     | <span style='background-color: #eee;'>    // }</span>
 438 |     | <span style='background-color: #eee;'>    // function swapExactTokensForETHSupportingFeeOnTransferTokens(</span>
 439 |     | <span style='background-color: #eee;'>    //     uint amountIn,</span>
 440 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 441 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 442 |     | <span style='background-color: #eee;'>    //     address to,</span>
 443 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 444 |     | <span style='background-color: #eee;'>    // )</span>
 445 |     | <span style='background-color: #eee;'>    //     external</span>
 446 |     | <span style='background-color: #eee;'>    //     virtual</span>
 447 |     | <span style='background-color: #eee;'>    //     override</span>
 448 |     | <span style='background-color: #eee;'>    //     ensure(deadline)</span>
 449 |     | <span style='background-color: #eee;'>    // {</span>
 450 |     | <span style='background-color: #eee;'>    //     require(path[path.length - 1] == WETH, &#39;UniswapV2Router: INVALID_PATH&#39;);</span>
 451 |     | <span style='background-color: #eee;'>    //     TransferHelper.safeTransferFrom(</span>
 452 |     | <span style='background-color: #eee;'>    //         path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn</span>
 453 |     | <span style='background-color: #eee;'>    //     );</span>
 454 |     | <span style='background-color: #eee;'>    //     _swapSupportingFeeOnTransferTokens(path, address(this));</span>
 455 |     | <span style='background-color: #eee;'>    //     uint amountOut = IERC20(WETH).balanceOf(address(this));</span>
 456 |     | <span style='background-color: #eee;'>    //     require(amountOut &gt;= amountOutMin, &#39;UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 457 |     | <span style='background-color: #eee;'>    //     IWETH(WETH).withdraw(amountOut);</span>
 458 |     | <span style='background-color: #eee;'>    //     TransferHelper.safeTransferETH(to, amountOut);</span>
 459 |     | <span style='background-color: #eee;'>    // }</span>
 460 |     | <span style='background-color: #eee;'></span>
 461 |     | <span style='background-color: #eee;'>    // **** LIBRARY FUNCTIONS ****</span>
 462 |     | <span style='background-color: #faa;'>    function quote(uint amountA, uint reserveA, uint reserveB) public pure virtual override returns (uint amountB) {</span>
 463 |     | <span style='background-color: #faa;'>        return UniswapV2Library.quote(amountA, reserveA, reserveB);</span>
 464 |     | <span style='background-color: #eee;'>    }</span>
 465 |     | <span style='background-color: #eee;'></span>
 466 |     | <span style='background-color: #faa;'>    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut)</span>
 467 |     | <span style='background-color: #eee;'>        public</span>
 468 |     | <span style='background-color: #eee;'>        pure</span>
 469 |     | <span style='background-color: #eee;'>        virtual</span>
 470 |     | <span style='background-color: #eee;'>        override</span>
 471 |     | <span style='background-color: #faa;'>        returns (uint amountOut)</span>
 472 |     | <span style='background-color: #eee;'>    {</span>
 473 |     | <span style='background-color: #faa;'>        return UniswapV2Library.getAmountOut(amountIn, reserveIn, reserveOut);</span>
 474 |     | <span style='background-color: #eee;'>    }</span>
 475 |     | <span style='background-color: #eee;'></span>
 476 |     | <span style='background-color: #faa;'>    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut)</span>
 477 |     | <span style='background-color: #eee;'>        public</span>
 478 |     | <span style='background-color: #eee;'>        pure</span>
 479 |     | <span style='background-color: #eee;'>        virtual</span>
 480 |     | <span style='background-color: #eee;'>        override</span>
 481 |     | <span style='background-color: #faa;'>        returns (uint amountIn)</span>
 482 |     | <span style='background-color: #eee;'>    {</span>
 483 |     | <span style='background-color: #faa;'>        return UniswapV2Library.getAmountIn(amountOut, reserveIn, reserveOut);</span>
 484 |     | <span style='background-color: #eee;'>    }</span>
 485 |     | <span style='background-color: #eee;'></span>
 486 |     | <span style='background-color: #faa;'>    function getAmountsOut(uint amountIn, address[] memory path)</span>
 487 |     | <span style='background-color: #eee;'>        public</span>
 488 |     | <span style='background-color: #eee;'>        view</span>
 489 |     | <span style='background-color: #eee;'>        virtual</span>
 490 |     | <span style='background-color: #eee;'>        override</span>
 491 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 492 |     | <span style='background-color: #eee;'>    {</span>
 493 |     | <span style='background-color: #faa;'>        return UniswapV2Library.getAmountsOut(factory, amountIn, path);</span>
 494 |     | <span style='background-color: #eee;'>    }</span>
 495 |     | <span style='background-color: #eee;'></span>
 496 |     | <span style='background-color: #faa;'>    function getAmountsIn(uint amountOut, address[] memory path)</span>
 497 |     | <span style='background-color: #eee;'>        public</span>
 498 |     | <span style='background-color: #eee;'>        view</span>
 499 |     | <span style='background-color: #eee;'>        virtual</span>
 500 |     | <span style='background-color: #eee;'>        override</span>
 501 |     | <span style='background-color: #faa;'>        returns (uint[] memory amounts)</span>
 502 |     | <span style='background-color: #eee;'>    {</span>
 503 |     | <span style='background-color: #faa;'>        return UniswapV2Library.getAmountsIn(factory, amountOut, path);</span>
 504 |     | <span style='background-color: #eee;'>    }</span>
 505 |     | <span style='background-color: #eee;'>}</span>
 506 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/interfaces/IERC20.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SDPX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>interface IERC20 {</span>
  5 |     | <span style='background-color: #eee;'>    event Approval(address indexed owner, address indexed spender, uint value);</span>
  6 |     | <span style='background-color: #eee;'>    event Transfer(address indexed from, address indexed to, uint value);</span>
  7 |     | <span style='background-color: #eee;'></span>
  8 |     | <span style='background-color: #eee;'>    function name() external view returns (string memory);</span>
  9 |     | <span style='background-color: #eee;'>    function symbol() external view returns (string memory);</span>
 10 |     | <span style='background-color: #eee;'>    function decimals() external view returns (uint8);</span>
 11 |     | <span style='background-color: #eee;'>    function totalSupply() external view returns (uint);</span>
 12 |     | <span style='background-color: #eee;'>    function balanceOf(address owner) external view returns (uint);</span>
 13 |     | <span style='background-color: #eee;'>    function allowance(address owner, address spender) external view returns (uint);</span>
 14 |     | <span style='background-color: #eee;'></span>
 15 |     | <span style='background-color: #eee;'>    function approve(address spender, uint value) external returns (bool);</span>
 16 |     | <span style='background-color: #eee;'>    function transfer(address to, uint value) external returns (bool);</span>
 17 |     | <span style='background-color: #eee;'>    function transferFrom(address from, address to, uint value) external returns (bool);</span>
 18 |     | <span style='background-color: #eee;'>}</span>
 19 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/interfaces/IUniswapV2Router01.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'>interface IUniswapV2Router01 {</span>
  4 |     | <span style='background-color: #eee;'>    function factory() external view returns (address);</span>
  5 |     | <span style='background-color: #eee;'>    function WETH() external view returns (address);</span>
  6 |     | <span style='background-color: #eee;'></span>
  7 |     | <span style='background-color: #eee;'>    function addLiquidity(</span>
  8 |     | <span style='background-color: #eee;'>        address tokenA,</span>
  9 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 10 |     | <span style='background-color: #eee;'>        uint amountADesired,</span>
 11 |     | <span style='background-color: #eee;'>        uint amountBDesired,</span>
 12 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 13 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 14 |     | <span style='background-color: #eee;'>        address to,</span>
 15 |     | <span style='background-color: #eee;'>        uint deadline</span>
 16 |     | <span style='background-color: #eee;'>    ) external returns (uint amountA, uint amountB, uint liquidity);</span>
 17 |     | <span style='background-color: #eee;'>    function addLiquidityETH(</span>
 18 |     | <span style='background-color: #eee;'>        address token,</span>
 19 |     | <span style='background-color: #eee;'>        uint amountTokenDesired,</span>
 20 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 21 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 22 |     | <span style='background-color: #eee;'>        address to,</span>
 23 |     | <span style='background-color: #eee;'>        uint deadline</span>
 24 |     | <span style='background-color: #eee;'>    ) external payable returns (uint amountToken, uint amountETH, uint liquidity);</span>
 25 |     | <span style='background-color: #eee;'>    function removeLiquidity(</span>
 26 |     | <span style='background-color: #eee;'>        address tokenA,</span>
 27 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 28 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 29 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 30 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 31 |     | <span style='background-color: #eee;'>        address to,</span>
 32 |     | <span style='background-color: #eee;'>        uint deadline</span>
 33 |     | <span style='background-color: #eee;'>    ) external returns (uint amountA, uint amountB);</span>
 34 |     | <span style='background-color: #eee;'>    function removeLiquidityETH(</span>
 35 |     | <span style='background-color: #eee;'>        address token,</span>
 36 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 37 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 38 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 39 |     | <span style='background-color: #eee;'>        address to,</span>
 40 |     | <span style='background-color: #eee;'>        uint deadline</span>
 41 |     | <span style='background-color: #eee;'>    ) external returns (uint amountToken, uint amountETH);</span>
 42 |     | <span style='background-color: #eee;'>    function removeLiquidityWithPermit(</span>
 43 |     | <span style='background-color: #eee;'>        address tokenA,</span>
 44 |     | <span style='background-color: #eee;'>        address tokenB,</span>
 45 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 46 |     | <span style='background-color: #eee;'>        uint amountAMin,</span>
 47 |     | <span style='background-color: #eee;'>        uint amountBMin,</span>
 48 |     | <span style='background-color: #eee;'>        address to,</span>
 49 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 50 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 51 |     | <span style='background-color: #eee;'>    ) external returns (uint amountA, uint amountB);</span>
 52 |     | <span style='background-color: #eee;'>    function removeLiquidityETHWithPermit(</span>
 53 |     | <span style='background-color: #eee;'>        address token,</span>
 54 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 55 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 56 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 57 |     | <span style='background-color: #eee;'>        address to,</span>
 58 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 59 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 60 |     | <span style='background-color: #eee;'>    ) external returns (uint amountToken, uint amountETH);</span>
 61 |     | <span style='background-color: #eee;'>    function swapExactTokensForTokens(</span>
 62 |     | <span style='background-color: #eee;'>        uint amountIn,</span>
 63 |     | <span style='background-color: #eee;'>        uint amountOutMin,</span>
 64 |     | <span style='background-color: #eee;'>        address[] calldata path,</span>
 65 |     | <span style='background-color: #eee;'>        address to,</span>
 66 |     | <span style='background-color: #eee;'>        uint deadline</span>
 67 |     | <span style='background-color: #eee;'>    ) external returns (uint[] memory amounts);</span>
 68 |     | <span style='background-color: #eee;'>    function swapTokensForExactTokens(</span>
 69 |     | <span style='background-color: #eee;'>        uint amountOut,</span>
 70 |     | <span style='background-color: #eee;'>        uint amountInMax,</span>
 71 |     | <span style='background-color: #eee;'>        address[] calldata path,</span>
 72 |     | <span style='background-color: #eee;'>        address to,</span>
 73 |     | <span style='background-color: #eee;'>        uint deadline</span>
 74 |     | <span style='background-color: #eee;'>    ) external returns (uint[] memory amounts);</span>
 75 |     | <span style='background-color: #eee;'>    function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
 76 |     | <span style='background-color: #eee;'>        external</span>
 77 |     | <span style='background-color: #eee;'>        payable</span>
 78 |     | <span style='background-color: #eee;'>        returns (uint[] memory amounts);</span>
 79 |     | <span style='background-color: #eee;'>    function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)</span>
 80 |     | <span style='background-color: #eee;'>        external</span>
 81 |     | <span style='background-color: #eee;'>        returns (uint[] memory amounts);</span>
 82 |     | <span style='background-color: #eee;'>    function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
 83 |     | <span style='background-color: #eee;'>        external</span>
 84 |     | <span style='background-color: #eee;'>        returns (uint[] memory amounts);</span>
 85 |     | <span style='background-color: #eee;'>    function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)</span>
 86 |     | <span style='background-color: #eee;'>        external</span>
 87 |     | <span style='background-color: #eee;'>        payable</span>
 88 |     | <span style='background-color: #eee;'>        returns (uint[] memory amounts);</span>
 89 |     | <span style='background-color: #eee;'></span>
 90 |     | <span style='background-color: #eee;'>    function quote(uint amountA, uint reserveA, uint reserveB) external pure returns (uint amountB);</span>
 91 |     | <span style='background-color: #eee;'>    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut);</span>
 92 |     | <span style='background-color: #eee;'>    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) external pure returns (uint amountIn);</span>
 93 |     | <span style='background-color: #eee;'>    function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts);</span>
 94 |     | <span style='background-color: #eee;'>    function getAmountsIn(uint amountOut, address[] calldata path) external view returns (uint[] memory amounts);</span>
 95 |     | <span style='background-color: #eee;'>}</span>
 96 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/interfaces/IUniswapV2Router02.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2Router01.sol&#39;;</span>
  5 |     | <span style='background-color: #eee;'></span>
  6 |     | <span style='background-color: #eee;'>interface IUniswapV2Router02 is IUniswapV2Router01 {</span>
  7 |     | <span style='background-color: #eee;'>    function removeLiquidityETHSupportingFeeOnTransferTokens(</span>
  8 |     | <span style='background-color: #eee;'>        address token,</span>
  9 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 10 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 11 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 12 |     | <span style='background-color: #eee;'>        address to,</span>
 13 |     | <span style='background-color: #eee;'>        uint deadline</span>
 14 |     | <span style='background-color: #eee;'>    ) external returns (uint amountETH);</span>
 15 |     | <span style='background-color: #eee;'>    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(</span>
 16 |     | <span style='background-color: #eee;'>        address token,</span>
 17 |     | <span style='background-color: #eee;'>        uint liquidity,</span>
 18 |     | <span style='background-color: #eee;'>        uint amountTokenMin,</span>
 19 |     | <span style='background-color: #eee;'>        uint amountETHMin,</span>
 20 |     | <span style='background-color: #eee;'>        address to,</span>
 21 |     | <span style='background-color: #eee;'>        uint deadline,</span>
 22 |     | <span style='background-color: #eee;'>        bool approveMax, uint8 v, bytes32 r, bytes32 s</span>
 23 |     | <span style='background-color: #eee;'>    ) external returns (uint amountETH);</span>
 24 |     | <span style='background-color: #eee;'></span>
 25 |     | <span style='background-color: #eee;'>    // function swapExactTokensForTokensSupportingFeeOnTransferTokens(</span>
 26 |     | <span style='background-color: #eee;'>    //     uint amountIn,</span>
 27 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 28 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 29 |     | <span style='background-color: #eee;'>    //     address to,</span>
 30 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 31 |     | <span style='background-color: #eee;'>    // ) external;</span>
 32 |     | <span style='background-color: #eee;'>    // function swapExactETHForTokensSupportingFeeOnTransferTokens(</span>
 33 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 34 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 35 |     | <span style='background-color: #eee;'>    //     address to,</span>
 36 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 37 |     | <span style='background-color: #eee;'>    // ) external payable;</span>
 38 |     | <span style='background-color: #eee;'>    // function swapExactTokensForETHSupportingFeeOnTransferTokens(</span>
 39 |     | <span style='background-color: #eee;'>    //     uint amountIn,</span>
 40 |     | <span style='background-color: #eee;'>    //     uint amountOutMin,</span>
 41 |     | <span style='background-color: #eee;'>    //     address[] calldata path,</span>
 42 |     | <span style='background-color: #eee;'>    //     address to,</span>
 43 |     | <span style='background-color: #eee;'>    //     uint deadline</span>
 44 |     | <span style='background-color: #eee;'>    // ) external;</span>
 45 |     | <span style='background-color: #eee;'>}</span>
 46 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/interfaces/IWETH.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SDPX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>interface IWETH {</span>
  5 |     | <span style='background-color: #eee;'>    function deposit() external payable;</span>
  6 |     | <span style='background-color: #eee;'>    function transfer(address to, uint value) external returns (bool);</span>
  7 |     | <span style='background-color: #eee;'>    function withdraw(uint) external;</span>
  8 |     | <span style='background-color: #eee;'>}</span>
  9 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/libraries/UniswapV2Library.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>import &quot;../test/IUniswapV2Pair.sol&quot;;</span>
  5 |     | <span style='background-color: #faa;'></span>
  6 |     | <span style='background-color: #eee;'>library UniswapV2Library {</span>
  7 |     | <span style='background-color: #eee;'></span>
  8 |     | <span style='background-color: #eee;'>    // returns sorted token addresses, used to handle return values from pairs sorted in this order</span>
  9 |     | <span style='background-color: #faa;'>    function sortTokens(address tokenA, address tokenB) internal pure returns (address token0, address token1) {</span>
 10 |     | <span style='background-color: #faa;'>        require(tokenA != tokenB, &#39;UniswapV2Library: IDENTICAL_ADDRESSES&#39;);</span>
 11 |     | <span style='background-color: #faa;'>        (token0, token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : (tokenB, tokenA);</span>
 12 |     | <span style='background-color: #faa;'>        require(token0 != address(0), &#39;UniswapV2Library: ZERO_ADDRESS&#39;);</span>
 13 |     | <span style='background-color: #eee;'>    }</span>
 14 |     | <span style='background-color: #eee;'></span>
 15 |     | <span style='background-color: #eee;'>    // calculates the CREATE2 address for a pair without making any external calls</span>
 16 |     | <span style='background-color: #faa;'>    function pairFor(address factory, address tokenA, address tokenB) internal pure returns (address pair) {</span>
 17 |     | <span style='background-color: #faa;'>        (address token0, address token1) = sortTokens(tokenA, tokenB);</span>
 18 |     | <span style='background-color: #faa;'>        pair = address(uint160(uint(keccak256(abi.encodePacked(</span>
 19 |     | <span style='background-color: #eee;'>                &quot;0xff&quot;,</span>
 20 |     | <span style='background-color: #faa;'>                factory,</span>
 21 |     | <span style='background-color: #faa;'>                keccak256(abi.encodePacked(token0, token1)),</span>
 22 |     | <span style='background-color: #eee;'>                hex&#39;0d8dfb1487e307d306de35d646644fe117ce584746770a743ccb761636daa6e4&#39; // init code hash</span>
 23 |     | <span style='background-color: #eee;'>            )))));</span>
 24 |     | <span style='background-color: #eee;'>    }</span>
 25 |     | <span style='background-color: #eee;'></span>
 26 |     | <span style='background-color: #eee;'>    // fetches and sorts the reserves for a pair</span>
 27 |     | <span style='background-color: #faa;'>    function getReserves(address factory, address tokenA, address tokenB) internal view returns (uint reserveA, uint reserveB) {</span>
 28 |     | <span style='background-color: #faa;'>        (address token0,) = sortTokens(tokenA, tokenB);</span>
 29 |     | <span style='background-color: #faa;'>        (uint reserve0, uint reserve1,) = IUniswapV2Pair(pairFor(factory, tokenA, tokenB)).getReserves();</span>
 30 |     | <span style='background-color: #faa;'>        (reserveA, reserveB) = tokenA == token0 ? (reserve0, reserve1) : (reserve1, reserve0);</span>
 31 |     | <span style='background-color: #eee;'>    }</span>
 32 |     | <span style='background-color: #eee;'></span>
 33 |     | <span style='background-color: #eee;'>    // given some amount of an asset and pair reserves, returns an equivalent amount of the other asset</span>
 34 |     | <span style='background-color: #faa;'>    function quote(uint amountA, uint reserveA, uint reserveB) internal pure returns (uint amountB) {</span>
 35 |     | <span style='background-color: #faa;'>        require(amountA &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_AMOUNT&#39;);</span>
 36 |     | <span style='background-color: #faa;'>        require(reserveA &gt; 0 &amp;&amp; reserveB &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_LIQUIDITY&#39;);</span>
 37 |     | <span style='background-color: #faa;'>        amountB = (amountA* reserveB) / reserveA;</span>
 38 |     | <span style='background-color: #eee;'>    }</span>
 39 |     | <span style='background-color: #eee;'></span>
 40 |     | <span style='background-color: #eee;'>    // given an input amount of an asset and pair reserves, returns the maximum output amount of the other asset</span>
 41 |     | <span style='background-color: #faa;'>    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) internal pure returns (uint amountOut) {</span>
 42 |     | <span style='background-color: #faa;'>        require(amountIn &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_INPUT_AMOUNT&#39;);</span>
 43 |     | <span style='background-color: #faa;'>        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_LIQUIDITY&#39;);</span>
 44 |     | <span style='background-color: #faa;'>        uint amountInWithFee = amountIn * 997;</span>
 45 |     | <span style='background-color: #faa;'>        uint numerator = amountInWithFee * reserveOut;</span>
 46 |     | <span style='background-color: #faa;'>        uint denominator = (reserveIn* 1000) + (amountInWithFee);</span>
 47 |     | <span style='background-color: #faa;'>        amountOut = numerator / denominator;</span>
 48 |     | <span style='background-color: #eee;'>    }</span>
 49 |     | <span style='background-color: #eee;'></span>
 50 |     | <span style='background-color: #eee;'>    // given an output amount of an asset and pair reserves, returns a required input amount of the other asset</span>
 51 |     | <span style='background-color: #faa;'>    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) internal pure returns (uint amountIn) {</span>
 52 |     | <span style='background-color: #faa;'>        require(amountOut &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 53 |     | <span style='background-color: #faa;'>        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, &#39;UniswapV2Library: INSUFFICIENT_LIQUIDITY&#39;);</span>
 54 |     | <span style='background-color: #faa;'>        uint numerator = reserveIn * amountOut *1000;</span>
 55 |     | <span style='background-color: #faa;'>        uint denominator = (reserveOut - amountOut) * 997;</span>
 56 |     | <span style='background-color: #faa;'>        amountIn = (numerator / denominator) + 1;</span>
 57 |     | <span style='background-color: #eee;'>    }</span>
 58 |     | <span style='background-color: #eee;'></span>
 59 |     | <span style='background-color: #eee;'>    // performs chained getAmountOut calculations on any number of pairs</span>
 60 |     | <span style='background-color: #faa;'>    function getAmountsOut(address factory, uint amountIn, address[] memory path) internal view returns (uint[] memory amounts) {</span>
 61 |     | <span style='background-color: #faa;'>        require(path.length &gt;= 2, &#39;UniswapV2Library: INVALID_PATH&#39;);</span>
 62 |     | <span style='background-color: #faa;'>        amounts = new uint[](path.length);</span>
 63 |     | <span style='background-color: #faa;'>        amounts[0] = amountIn;</span>
 64 |     | <span style='background-color: #faa;'>        for (uint i; i &lt; path.length - 1; i++) {</span>
 65 |     | <span style='background-color: #faa;'>            (uint reserveIn, uint reserveOut) = getReserves(factory, path[i], path[i + 1]);</span>
 66 |     | <span style='background-color: #faa;'>            amounts[i + 1] = getAmountOut(amounts[i], reserveIn, reserveOut);</span>
 67 |     | <span style='background-color: #eee;'>        }</span>
 68 |     | <span style='background-color: #eee;'>    }</span>
 69 |     | <span style='background-color: #eee;'></span>
 70 |     | <span style='background-color: #eee;'>    // performs chained getAmountIn calculations on any number of pairs</span>
 71 |     | <span style='background-color: #faa;'>    function getAmountsIn(address factory, uint amountOut, address[] memory path) internal view returns (uint[] memory amounts) {</span>
 72 |     | <span style='background-color: #faa;'>        require(path.length &gt;= 2, &#39;UniswapV2Library: INVALID_PATH&#39;);</span>
 73 |     | <span style='background-color: #faa;'>        amounts = new uint[](path.length);</span>
 74 |     | <span style='background-color: #faa;'>        amounts[amounts.length - 1] = amountOut;</span>
 75 |     | <span style='background-color: #faa;'>        for (uint i = path.length - 1; i &gt; 0; i--) {</span>
 76 |     | <span style='background-color: #faa;'>            (uint reserveIn, uint reserveOut) = getReserves(factory, path[i - 1], path[i]);</span>
 77 |     | <span style='background-color: #faa;'>            amounts[i - 1] = getAmountIn(amounts[i], reserveIn, reserveOut);</span>
 78 |     | <span style='background-color: #eee;'>        }</span>
 79 |     | <span style='background-color: #eee;'>    }</span>
 80 |     | <span style='background-color: #eee;'>}</span>
 81 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/EchidnaUniV2Tester.sol</b>
<code>
   1 |     | <span style='background-color: #eee;'>//SPDX-License-Identifier: MIT</span>
   2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
   3 |     | <span style='background-color: #eee;'>import &quot;./Setup.sol&quot;;</span>
   4 | *r  | <span style='background-color: #afa;'></span>
   5 |     | <span style='background-color: #eee;'>contract EchidnaTest is Setup {</span>
   6 |     | <span style='background-color: #eee;'></span>
   7 |     | <span style='background-color: #eee;'>    // 1 invariant: Providing liquidity increases invariant</span>
   8 |     | <span style='background-color: #eee;'>    // x*y = k =&gt; increasing x and y increases k!</span>
   9 | *r  | <span style='background-color: #afa;'>    function testProvideLiquidity(uint amount1, uint amount2) external {</span>
  10 |     | <span style='background-color: #eee;'>    </span>
  11 | *r  | <span style='background-color: #afa;'>        if(!completed) {</span>
  12 |     | <span style='background-color: #eee;'>            // Pre-conditions: we gotta have 1000 as MINIMUM_LIQUIDITY</span>
  13 | *   | <span style='background-color: #afa;'>            amount1 = _between(amount1, 1000, ~uint(0));</span>
  14 | *   | <span style='background-color: #afa;'>            amount2 = _between(amount2, 1000, ~uint(0));</span>
  15 | *   | <span style='background-color: #afa;'>            _mintTokens(amount1, amount2);</span>
  16 |     | <span style='background-color: #eee;'>        }</span>
  17 | *r  | <span style='background-color: #afa;'>        uint lpTokenBalanceBefore = pair.balanceOf(address(user));</span>
  18 | *r  | <span style='background-color: #afa;'>        (uint reserve0Before, uint reserve1Before,) = pair.getReserves();</span>
  19 | *r  | <span style='background-color: #afa;'>        uint kBefore = reserve0Before * reserve1Before; // Solidity ^0.6.0, it might create an overflow/underflow, but since we use uint112/uint112 =&gt; uint112 * uint112 = uint224&lt;uint256, it&#39;s not gonna happen</span>
  20 |     | <span style='background-color: #eee;'></span>
  21 | *r  | <span style='background-color: #afa;'>        (bool success,) = user.proxy(address(testToken1), abi.encodeWithSelector(testToken1.transfer.selector, address(pair), amount1));</span>
  22 | *r  | <span style='background-color: #afa;'>        (bool success1,) = user.proxy(address(testToken2), abi.encodeWithSelector(testToken2.transfer.selector, address(pair), amount2));</span>
  23 | *r  | <span style='background-color: #afa;'>        require(success &amp;&amp; success1);</span>
  24 |     | <span style='background-color: #eee;'></span>
  25 |     | <span style='background-color: #eee;'>        // Actions. Adding liquidity</span>
  26 | *   | <span style='background-color: #afa;'>        (bool success2, ) = user.proxy(address(pair), abi.encodeWithSelector(bytes4(keccak256(&quot;mint(address)&quot;)), address(user)));</span>
  27 |     | <span style='background-color: #eee;'></span>
  28 |     | <span style='background-color: #eee;'>        // Post-conditions</span>
  29 | *   | <span style='background-color: #afa;'>        if(success2) {</span>
  30 |     | <span style='background-color: #eee;'></span>
  31 | *   | <span style='background-color: #afa;'>            uint lpTokenBalanceAfter = pair.balanceOf(address(user));</span>
  32 | *   | <span style='background-color: #afa;'>            (uint reserve0After, uint reserve1After,) = pair.getReserves();</span>
  33 | *   | <span style='background-color: #afa;'>            uint kAfter = reserve0After * reserve1After;</span>
  34 |     | <span style='background-color: #eee;'></span>
  35 | *   | <span style='background-color: #afa;'>            assert(lpTokenBalanceBefore &lt; lpTokenBalanceAfter);</span>
  36 | *   | <span style='background-color: #afa;'>            assert(kBefore &lt; kAfter);</span>
  37 |     | <span style='background-color: #eee;'></span>
  38 |     | <span style='background-color: #eee;'>        }</span>
  39 |     | <span style='background-color: #eee;'>    }</span>
  40 | *r  | <span style='background-color: #afa;'>    function testSwap(uint amount1, uint amount2) external {</span>
  41 |     | <span style='background-color: #eee;'>        // Pre-conditions:</span>
  42 | *r  | <span style='background-color: #afa;'>        if(!completed) {</span>
  43 | r   | <span style='background-color: #ffa;'>            _mintTokens(amount1, amount2);</span>
  44 |     | <span style='background-color: #eee;'></span>
  45 |     | <span style='background-color: #eee;'>        }</span>
  46 | *r  | <span style='background-color: #afa;'>        require(pair.balanceOf(address(user)) &gt; 0); // there is liquidity</span>
  47 | *   | <span style='background-color: #afa;'>        pair.sync(); // match the balances with the reserves</span>
  48 |     | <span style='background-color: #eee;'></span>
  49 |     | <span style='background-color: #eee;'>        //Call:</span>
  50 | *   | <span style='background-color: #afa;'>        (bool success1,) = user.proxy(address(pair), abi.encodeWithSelector(pair.swap.selector, amount1, amount2, address(user), &quot;&quot;));</span>
  51 |     | <span style='background-color: #eee;'></span>
  52 |     | <span style='background-color: #eee;'>        // Post-condition</span>
  53 | *   | <span style='background-color: #afa;'>        assert(!success1); // call should never succeed</span>
  54 |     | <span style='background-color: #eee;'>    }</span>
  55 |     | <span style='background-color: #eee;'>    </span>
  56 |     | <span style='background-color: #eee;'>}</span>
  57 |     | <span style='background-color: #faa;'></span>
  58 |     | <span style='background-color: #eee;'>contract EchidnaUniV2Tester is Setup {</span>
  59 |     | <span style='background-color: #eee;'>    </span>
  60 |     | <span style='background-color: #eee;'>    event logUints(uint kBefore, uint kAfter);</span>
  61 |     | <span style='background-color: #faa;'>    function testProvideLiquidityInvariants(uint amount1, uint amount2) public {</span>
  62 |     | <span style='background-color: #eee;'>        //PRECONDITIONS:</span>
  63 |     | <span style='background-color: #faa;'>        amount1 = _between(amount1, 1000, ~uint(0));</span>
  64 |     | <span style='background-color: #faa;'>        amount2 = _between(amount2, 1000, ~uint(0));</span>
  65 |     | <span style='background-color: #faa;'>        if(!completed) {</span>
  66 |     | <span style='background-color: #faa;'>            _mintTokens(amount1,amount2);</span>
  67 |     | <span style='background-color: #eee;'>        }</span>
  68 |     | <span style='background-color: #eee;'>        </span>
  69 |     | <span style='background-color: #faa;'>        uint pairBalanceBefore = pair.balanceOf(address(user));</span>
  70 |     | <span style='background-color: #eee;'>        </span>
  71 |     | <span style='background-color: #faa;'>        (uint reserve1Before, uint reserve2Before) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
  72 |     | <span style='background-color: #eee;'>        </span>
  73 |     | <span style='background-color: #faa;'>        uint kBefore = reserve1Before * reserve2Before;</span>
  74 |     | <span style='background-color: #eee;'>       </span>
  75 |     | <span style='background-color: #eee;'>        //CALL:</span>
  76 |     | <span style='background-color: #eee;'>        </span>
  77 |     | <span style='background-color: #faa;'>        (bool success, ) = user.proxy(address(router),abi.encodeWithSelector(router.addLiquidity.selector, address(testToken1), address(testToken2), amount1, amount2, 0, 0, address(user), ~uint(0)));</span>
  78 |     | <span style='background-color: #eee;'>        </span>
  79 |     | <span style='background-color: #eee;'>        //POSTCONDITIONS</span>
  80 |     | <span style='background-color: #eee;'>       </span>
  81 |     | <span style='background-color: #faa;'>        if (success) {</span>
  82 |     | <span style='background-color: #faa;'>            (uint reserve1After, uint reserve2After) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
  83 |     | <span style='background-color: #faa;'>            uint pairBalanceAfter = pair.balanceOf(address(user));</span>
  84 |     | <span style='background-color: #faa;'>            uint kAfter = reserve1After*reserve2After;</span>
  85 |     | <span style='background-color: #faa;'>            assert(kBefore &lt; kAfter);</span>
  86 |     | <span style='background-color: #faa;'>            assert(pairBalanceBefore &lt; pairBalanceAfter);</span>
  87 |     | <span style='background-color: #eee;'>        }</span>
  88 |     | <span style='background-color: #eee;'>       </span>
  89 |     | <span style='background-color: #eee;'>        </span>
  90 |     | <span style='background-color: #eee;'>    }</span>
  91 |     | <span style='background-color: #eee;'>   </span>
  92 |     | <span style='background-color: #faa;'>    function testSwapTokens(uint swapAmountIn) public {</span>
  93 |     | <span style='background-color: #eee;'>       //PRECONDITIONS:</span>
  94 |     | <span style='background-color: #eee;'></span>
  95 |     | <span style='background-color: #faa;'>       if(!completed) {</span>
  96 |     | <span style='background-color: #faa;'>            _mintTokens(swapAmountIn,swapAmountIn);</span>
  97 |     | <span style='background-color: #eee;'>        }</span>
  98 |     | <span style='background-color: #eee;'>        </span>
  99 |     | <span style='background-color: #faa;'>        address[] memory path = new address[](2);</span>
 100 |     | <span style='background-color: #faa;'>        path[0] = address(testToken1);</span>
 101 |     | <span style='background-color: #faa;'>        path[1] = address(testToken2);</span>
 102 |     | <span style='background-color: #eee;'></span>
 103 |     | <span style='background-color: #faa;'>        uint prevBal1 = UniswapV2ERC20(path[0]).balanceOf(address(user));</span>
 104 |     | <span style='background-color: #faa;'>        uint prevBal2 = UniswapV2ERC20(path[1]).balanceOf(address(user));</span>
 105 |     | <span style='background-color: #eee;'></span>
 106 |     | <span style='background-color: #faa;'>        require(prevBal1 &gt; 0);</span>
 107 |     | <span style='background-color: #faa;'>        swapAmountIn = _between(swapAmountIn, 1, prevBal1);</span>
 108 |     | <span style='background-color: #faa;'>        (uint reserve1Before, uint reserve2Before) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
 109 |     | <span style='background-color: #faa;'>        uint kBefore = reserve1Before * reserve2Before; </span>
 110 |     | <span style='background-color: #eee;'>        //CALL: </span>
 111 |     | <span style='background-color: #faa;'>        (bool success, ) = user.proxy(address(router), abi.encodeWithSelector(router.swapExactTokensForTokens.selector, swapAmountIn,0,path,address(user),~uint(0)));</span>
 112 |     | <span style='background-color: #eee;'>        //POSTCONDITIONS:</span>
 113 |     | <span style='background-color: #eee;'>           </span>
 114 |     | <span style='background-color: #faa;'>        if(success) {</span>
 115 |     | <span style='background-color: #faa;'>            uint balance1After = UniswapV2ERC20(path[0]).balanceOf(address(user));</span>
 116 |     | <span style='background-color: #faa;'>            uint balance2After  = UniswapV2ERC20(path[1]).balanceOf(address(user));</span>
 117 |     | <span style='background-color: #faa;'>            (uint reserve1After, uint reserve2After) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
 118 |     | <span style='background-color: #faa;'>            uint kAfter = reserve1After*reserve2After;</span>
 119 |     | <span style='background-color: #faa;'>            emit logUints(kBefore, kAfter);</span>
 120 |     | <span style='background-color: #faa;'>            assert(kBefore &lt;= kAfter); </span>
 121 |     | <span style='background-color: #faa;'>            assert(prevBal2 &lt; balance2After);</span>
 122 |     | <span style='background-color: #faa;'>            assert(prevBal1 &gt; balance1After);</span>
 123 |     | <span style='background-color: #eee;'>            </span>
 124 |     | <span style='background-color: #eee;'>        }</span>
 125 |     | <span style='background-color: #eee;'>    }</span>
 126 |     | <span style='background-color: #eee;'></span>
 127 |     | <span style='background-color: #faa;'>    function testRemoveLiquidityInvariants(uint lpAmount) public {</span>
 128 |     | <span style='background-color: #eee;'>        //PRECONDITIONS:</span>
 129 |     | <span style='background-color: #eee;'></span>
 130 |     | <span style='background-color: #faa;'>        uint pairBalanceBefore = pair.balanceOf(address(user));</span>
 131 |     | <span style='background-color: #eee;'>        //user needs some LP tokens to burn</span>
 132 |     | <span style='background-color: #faa;'>        require(pairBalanceBefore &gt; 0);</span>
 133 |     | <span style='background-color: #faa;'>        lpAmount = _between(lpAmount, 1, pairBalanceBefore);</span>
 134 |     | <span style='background-color: #eee;'>        </span>
 135 |     | <span style='background-color: #faa;'>        (uint reserve1Before, uint reserve2Before) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
 136 |     | <span style='background-color: #eee;'>        //need to provide more than min liquidity</span>
 137 |     | <span style='background-color: #faa;'>        uint kBefore = reserve1Before * reserve2Before;</span>
 138 |     | <span style='background-color: #faa;'>       (bool success1,) = user.proxy(address(pair),abi.encodeWithSelector(pair.approve.selector,address(router), ~uint(0)));</span>
 139 |     | <span style='background-color: #faa;'>        require(success1);</span>
 140 |     | <span style='background-color: #eee;'>        //CALL:</span>
 141 |     | <span style='background-color: #eee;'>        </span>
 142 |     | <span style='background-color: #faa;'>        (bool success, ) = user.proxy(address(router),abi.encodeWithSelector(router.removeLiquidity.selector, address(testToken1), address(testToken2),lpAmount, 0, 0, address(user), ~uint(0)));</span>
 143 |     | <span style='background-color: #eee;'>        </span>
 144 |     | <span style='background-color: #eee;'>        //POSTCONDITIONS</span>
 145 |     | <span style='background-color: #eee;'>        </span>
 146 |     | <span style='background-color: #faa;'>        if (success) {</span>
 147 |     | <span style='background-color: #faa;'>            (uint reserve1After, uint reserve2After) = UniswapV2Library.getReserves(address(factory), address(testToken1), address(testToken2));</span>
 148 |     | <span style='background-color: #faa;'>            uint pairBalanceAfter = pair.balanceOf(address(user));</span>
 149 |     | <span style='background-color: #faa;'>            uint kAfter = reserve1After*reserve2After;</span>
 150 |     | <span style='background-color: #faa;'>            assert(kBefore &gt; kAfter);</span>
 151 |     | <span style='background-color: #faa;'>            assert(pairBalanceBefore &gt; pairBalanceAfter);</span>
 152 |     | <span style='background-color: #eee;'>        }</span>
 153 |     | <span style='background-color: #eee;'>    }</span>
 154 |     | <span style='background-color: #eee;'>}</span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/IERC20.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>interface IERC20 {</span>
  5 |     | <span style='background-color: #eee;'>    event Approval(address indexed owner, address indexed spender, uint value);</span>
  6 |     | <span style='background-color: #eee;'>    event Transfer(address indexed from, address indexed to, uint value);</span>
  7 |     | <span style='background-color: #eee;'></span>
  8 |     | <span style='background-color: #eee;'>    function name() external view returns (string memory);</span>
  9 |     | <span style='background-color: #eee;'>    function symbol() external view returns (string memory);</span>
 10 |     | <span style='background-color: #eee;'>    function decimals() external view returns (uint8);</span>
 11 |     | <span style='background-color: #eee;'>    function totalSupply() external view returns (uint);</span>
 12 |     | <span style='background-color: #eee;'>    function balanceOf(address owner) external view returns (uint);</span>
 13 |     | <span style='background-color: #eee;'>    function allowance(address owner, address spender) external view returns (uint);</span>
 14 |     | <span style='background-color: #eee;'></span>
 15 |     | <span style='background-color: #eee;'>    function approve(address spender, uint value) external returns (bool);</span>
 16 |     | <span style='background-color: #eee;'>    function transfer(address to, uint value) external returns (bool);</span>
 17 |     | <span style='background-color: #eee;'>    function transferFrom(address from, address to, uint value) external returns (bool);</span>
 18 |     | <span style='background-color: #eee;'>}</span>
 19 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/IUniswapV2Callee.sol</b>
<code>
 1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
 2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
 3 |     | <span style='background-color: #eee;'></span>
 4 |     | <span style='background-color: #eee;'>interface IUniswapV2Callee {</span>
 5 |     | <span style='background-color: #eee;'>    function uniswapV2Call(address sender, uint amount0, uint amount1, bytes calldata data) external;</span>
 6 |     | <span style='background-color: #eee;'>}</span>
 7 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/IUniswapV2ERC20.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>interface IUniswapV2ERC20 {</span>
  5 |     | <span style='background-color: #eee;'>    event Approval(address indexed owner, address indexed spender, uint value);</span>
  6 |     | <span style='background-color: #eee;'>    event Transfer(address indexed from, address indexed to, uint value);</span>
  7 |     | <span style='background-color: #eee;'></span>
  8 |     | <span style='background-color: #eee;'>    function name() external pure returns (string memory);</span>
  9 |     | <span style='background-color: #eee;'>    function symbol() external pure returns (string memory);</span>
 10 |     | <span style='background-color: #eee;'>    function decimals() external pure returns (uint8);</span>
 11 |     | <span style='background-color: #eee;'>    function totalSupply() external view returns (uint);</span>
 12 |     | <span style='background-color: #eee;'>    function balanceOf(address owner) external view returns (uint);</span>
 13 |     | <span style='background-color: #eee;'>    function allowance(address owner, address spender) external view returns (uint);</span>
 14 |     | <span style='background-color: #eee;'></span>
 15 |     | <span style='background-color: #eee;'>    function approve(address spender, uint value) external returns (bool);</span>
 16 |     | <span style='background-color: #eee;'>    function transfer(address to, uint value) external returns (bool);</span>
 17 |     | <span style='background-color: #eee;'>    function transferFrom(address from, address to, uint value) external returns (bool);</span>
 18 |     | <span style='background-color: #eee;'></span>
 19 |     | <span style='background-color: #eee;'>    function DOMAIN_SEPARATOR() external view returns (bytes32);</span>
 20 |     | <span style='background-color: #eee;'>    function PERMIT_TYPEHASH() external pure returns (bytes32);</span>
 21 |     | <span style='background-color: #eee;'>    function nonces(address owner) external view returns (uint);</span>
 22 |     | <span style='background-color: #eee;'></span>
 23 |     | <span style='background-color: #eee;'>    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external;</span>
 24 |     | <span style='background-color: #eee;'>}</span>
 25 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/IUniswapV2Factory.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>interface IUniswapV2Factory {</span>
  5 |     | <span style='background-color: #eee;'>    event PairCreated(address indexed token0, address indexed token1, address pair, uint);</span>
  6 |     | <span style='background-color: #eee;'></span>
  7 |     | <span style='background-color: #eee;'>    function feeTo() external view returns (address);</span>
  8 |     | <span style='background-color: #eee;'>    function feeToSetter() external view returns (address);</span>
  9 |     | <span style='background-color: #eee;'></span>
 10 |     | <span style='background-color: #eee;'>    function getPair(address tokenA, address tokenB) external view returns (address pair);</span>
 11 |     | <span style='background-color: #eee;'>    function allPairs(uint) external view returns (address pair);</span>
 12 |     | <span style='background-color: #eee;'>    function allPairsLength() external view returns (uint);</span>
 13 |     | <span style='background-color: #eee;'></span>
 14 |     | <span style='background-color: #eee;'>    function createPair(address tokenA, address tokenB) external returns (address pair);</span>
 15 |     | <span style='background-color: #eee;'></span>
 16 |     | <span style='background-color: #eee;'>    function setFeeTo(address) external;</span>
 17 |     | <span style='background-color: #eee;'>    function setFeeToSetter(address) external;</span>
 18 |     | <span style='background-color: #eee;'>}</span>
 19 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/IUniswapV2Pair.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'>import &quot;./IUniswapV2ERC20.sol&quot;;</span>
  4 |     | <span style='background-color: #eee;'></span>
  5 |     | <span style='background-color: #eee;'>interface IUniswapV2Pair is IUniswapV2ERC20 {</span>
  6 |     | <span style='background-color: #eee;'></span>
  7 |     | <span style='background-color: #eee;'>    event Mint(address indexed sender, uint amount0, uint amount1);</span>
  8 |     | <span style='background-color: #eee;'>    event Burn(address indexed sender, uint amount0, uint amount1, address indexed to);</span>
  9 |     | <span style='background-color: #eee;'>    event Swap(</span>
 10 |     | <span style='background-color: #eee;'>        address indexed sender,</span>
 11 |     | <span style='background-color: #eee;'>        uint amount0In,</span>
 12 |     | <span style='background-color: #eee;'>        uint amount1In,</span>
 13 |     | <span style='background-color: #eee;'>        uint amount0Out,</span>
 14 |     | <span style='background-color: #eee;'>        uint amount1Out,</span>
 15 |     | <span style='background-color: #eee;'>        address indexed to</span>
 16 |     | <span style='background-color: #eee;'>    );</span>
 17 |     | <span style='background-color: #eee;'>    event Sync(uint112 reserve0, uint112 reserve1);</span>
 18 |     | <span style='background-color: #eee;'></span>
 19 |     | <span style='background-color: #eee;'>    function MINIMUM_LIQUIDITY() external pure returns (uint);</span>
 20 |     | <span style='background-color: #eee;'>    function factory() external view returns (address);</span>
 21 |     | <span style='background-color: #eee;'>    function token0() external view returns (address);</span>
 22 |     | <span style='background-color: #eee;'>    function token1() external view returns (address);</span>
 23 |     | <span style='background-color: #eee;'>    function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);</span>
 24 |     | <span style='background-color: #eee;'>    function price0CumulativeLast() external view returns (uint);</span>
 25 |     | <span style='background-color: #eee;'>    function price1CumulativeLast() external view returns (uint);</span>
 26 |     | <span style='background-color: #eee;'>    function kLast() external view returns (uint);</span>
 27 |     | <span style='background-color: #eee;'></span>
 28 |     | <span style='background-color: #eee;'>    function mint(address to) external returns (uint liquidity);</span>
 29 |     | <span style='background-color: #eee;'>    function burn(address to) external returns (uint amount0, uint amount1);</span>
 30 |     | <span style='background-color: #eee;'>    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;</span>
 31 |     | <span style='background-color: #eee;'>    function skim(address to) external;</span>
 32 |     | <span style='background-color: #eee;'>    function sync() external;</span>
 33 |     | <span style='background-color: #eee;'></span>
 34 |     | <span style='background-color: #eee;'>    function initialize(address, address) external;</span>
 35 |     | <span style='background-color: #eee;'>}</span>
 36 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/Math.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>// a library for performing various math operations</span>
  5 |     | <span style='background-color: #faa;'></span>
  6 |     | <span style='background-color: #eee;'>library Math {</span>
  7 |     | <span style='background-color: #faa;'>    function min(uint x, uint y) internal pure returns (uint z) {</span>
  8 |     | <span style='background-color: #faa;'>        z = x &lt; y ? x : y;</span>
  9 |     | <span style='background-color: #eee;'>    }</span>
 10 |     | <span style='background-color: #eee;'></span>
 11 |     | <span style='background-color: #eee;'>    // babylonian method (https://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Babylonian_method)</span>
 12 | *   | <span style='background-color: #afa;'>    function sqrt(uint y) internal pure returns (uint z) {</span>
 13 | *   | <span style='background-color: #afa;'>        if (y &gt; 3) {</span>
 14 | *   | <span style='background-color: #afa;'>            z = y;</span>
 15 | *   | <span style='background-color: #afa;'>            uint x = y / 2 + 1;</span>
 16 | *   | <span style='background-color: #afa;'>            while (x &lt; z) {</span>
 17 | *   | <span style='background-color: #afa;'>                z = x;</span>
 18 | *   | <span style='background-color: #afa;'>                x = (y / x + x) / 2;</span>
 19 |     | <span style='background-color: #eee;'>            }</span>
 20 |     | <span style='background-color: #faa;'>        } else if (y != 0) {</span>
 21 |     | <span style='background-color: #faa;'>            z = 1;</span>
 22 |     | <span style='background-color: #eee;'>        }</span>
 23 |     | <span style='background-color: #eee;'>    }</span>
 24 |     | <span style='background-color: #eee;'>}</span>
 25 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/Setup.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>import &quot;./UniswapV2Pair.sol&quot;;</span>
  5 |     | <span style='background-color: #eee;'>import &quot;./UniswapV2ERC20.sol&quot;;</span>
  6 |     | <span style='background-color: #eee;'>import &quot;./UniswapV2Factory.sol&quot;;</span>
  7 |     | <span style='background-color: #eee;'>import {UniswapV2Library, UniswapV2Router02} from &quot;../UniswapV2Router02.sol&quot;;</span>
  8 | *r  | <span style='background-color: #afa;'></span>
  9 |     | <span style='background-color: #eee;'>contract Users {</span>
 10 | *r  | <span style='background-color: #afa;'>  function proxy(address target, bytes memory _calldata)</span>
 11 |     | <span style='background-color: #eee;'>    public</span>
 12 | *r  | <span style='background-color: #afa;'>    returns (bool success, bytes memory returnData)</span>
 13 |     | <span style='background-color: #eee;'>  {</span>
 14 | *r  | <span style='background-color: #afa;'>    (success, returnData) = address(target).call(_calldata);</span>
 15 |     | <span style='background-color: #eee;'>  }</span>
 16 |     | <span style='background-color: #eee;'>}</span>
 17 |     | <span style='background-color: #faa;'></span>
 18 |     | <span style='background-color: #eee;'>contract Setup {</span>
 19 |     | <span style='background-color: #eee;'>    UniswapV2ERC20 testToken1; </span>
 20 |     | <span style='background-color: #eee;'>    UniswapV2ERC20 testToken2;</span>
 21 |     | <span style='background-color: #eee;'>    UniswapV2Pair pair;</span>
 22 |     | <span style='background-color: #eee;'>    UniswapV2Factory factory;</span>
 23 |     | <span style='background-color: #eee;'>    UniswapV2Router02 router;</span>
 24 |     | <span style='background-color: #eee;'>    Users user;</span>
 25 |     | <span style='background-color: #eee;'>    bool completed;</span>
 26 |     | <span style='background-color: #eee;'>   </span>
 27 |     | <span style='background-color: #eee;'>    event Debug(string str);</span>
 28 |     | <span style='background-color: #faa;'>    constructor() {</span>
 29 |     | <span style='background-color: #faa;'>        testToken1 = new UniswapV2ERC20();</span>
 30 |     | <span style='background-color: #faa;'>        testToken2 = new UniswapV2ERC20();</span>
 31 |     | <span style='background-color: #faa;'>        factory = new UniswapV2Factory(address(this)); //this contract will be the fee setter</span>
 32 |     | <span style='background-color: #faa;'>        router = new UniswapV2Router02(address(factory),address(0)); // we don&#39;t need to test WETH pairs for now</span>
 33 |     | <span style='background-color: #faa;'>        address pairAddr = factory.createPair(address(testToken1), address(testToken2));</span>
 34 |     | <span style='background-color: #faa;'>        pair = UniswapV2Pair(pairAddr);</span>
 35 |     | <span style='background-color: #faa;'>        user = new Users();</span>
 36 |     | <span style='background-color: #eee;'>    }</span>
 37 |     | <span style='background-color: #eee;'>    </span>
 38 | *r  | <span style='background-color: #afa;'>    function _doApprovals() internal {</span>
 39 | *r  | <span style='background-color: #afa;'>        user.proxy(address(testToken1),abi.encodeWithSelector(testToken1.approve.selector,address(router), ~uint(0)));</span>
 40 | *r  | <span style='background-color: #afa;'>        user.proxy(address(testToken2),abi.encodeWithSelector(testToken2.approve.selector,address(router), ~uint(0)));</span>
 41 |     | <span style='background-color: #eee;'>    }</span>
 42 |     | <span style='background-color: #eee;'></span>
 43 | *r  | <span style='background-color: #afa;'>    function _mintTokens(uint amount1, uint amount2) internal {</span>
 44 | *r  | <span style='background-color: #afa;'>        testToken2.mint(address(user), amount2);</span>
 45 | *r  | <span style='background-color: #afa;'>        testToken1.mint(address(user), amount1); </span>
 46 | *r  | <span style='background-color: #afa;'>        _doApprovals();</span>
 47 | *r  | <span style='background-color: #afa;'>        completed = true;</span>
 48 |     | <span style='background-color: #eee;'>    }</span>
 49 |     | <span style='background-color: #eee;'>    </span>
 50 | *   | <span style='background-color: #afa;'>    function _between(</span>
 51 |     | <span style='background-color: #eee;'>        uint256 val,</span>
 52 |     | <span style='background-color: #eee;'>        uint256 lower,</span>
 53 |     | <span style='background-color: #eee;'>        uint256 upper</span>
 54 | *   | <span style='background-color: #afa;'>    ) internal pure returns (uint256) {</span>
 55 | *   | <span style='background-color: #afa;'>        return lower + (val % (upper - lower + 1));</span>
 56 |     | <span style='background-color: #eee;'>    }</span>
 57 |     | <span style='background-color: #eee;'>    </span>
 58 |     | <span style='background-color: #eee;'>}</span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/UQ112x112.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>// a library for handling binary fixed point numbers (https://en.wikipedia.org/wiki/Q_(number_format))</span>
  5 |     | <span style='background-color: #eee;'></span>
  6 |     | <span style='background-color: #eee;'>// range: [0, 2**112 - 1]</span>
  7 |     | <span style='background-color: #eee;'>// resolution: 1 / 2**112</span>
  8 |     | <span style='background-color: #faa;'></span>
  9 |     | <span style='background-color: #eee;'>library UQ112x112 {</span>
 10 | *   | <span style='background-color: #afa;'>    uint224 constant Q112 = 2**112;</span>
 11 |     | <span style='background-color: #eee;'></span>
 12 |     | <span style='background-color: #eee;'>    // encode a uint112 as a UQ112x112</span>
 13 | *   | <span style='background-color: #afa;'>    function encode(uint112 y) internal pure returns (uint224 z) {</span>
 14 | *   | <span style='background-color: #afa;'>        z = uint224(y) * Q112; // never overflows</span>
 15 |     | <span style='background-color: #eee;'>    }</span>
 16 |     | <span style='background-color: #eee;'></span>
 17 |     | <span style='background-color: #eee;'>    // divide a UQ112x112 by a uint112, returning a UQ112x112</span>
 18 | *   | <span style='background-color: #afa;'>    function uqdiv(uint224 x, uint112 y) internal pure returns (uint224 z) {</span>
 19 | *   | <span style='background-color: #afa;'>        z = x / uint224(y);</span>
 20 |     | <span style='background-color: #eee;'>    }</span>
 21 |     | <span style='background-color: #eee;'>}</span>
 22 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/UniswapV2ERC20.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2ERC20.sol&#39;;</span>
  5 | *r  | <span style='background-color: #afa;'></span>
  6 |     | <span style='background-color: #eee;'>contract UniswapV2ERC20 is IUniswapV2ERC20 {</span>
  7 |     | <span style='background-color: #eee;'></span>
  8 |     | <span style='background-color: #faa;'>    string public constant name = &#39;Uniswap V2&#39;;</span>
  9 |     | <span style='background-color: #faa;'>    string public constant symbol = &#39;UNI-V2&#39;;</span>
 10 |     | <span style='background-color: #faa;'>    uint8 public constant decimals = 18;</span>
 11 |     | <span style='background-color: #faa;'>    uint  public totalSupply;</span>
 12 | *r  | <span style='background-color: #afa;'>    mapping(address =&gt; uint) public balanceOf;</span>
 13 |     | <span style='background-color: #faa;'>    mapping(address =&gt; mapping(address =&gt; uint)) public allowance;</span>
 14 |     | <span style='background-color: #eee;'></span>
 15 |     | <span style='background-color: #faa;'>    bytes32 public override DOMAIN_SEPARATOR;</span>
 16 |     | <span style='background-color: #eee;'>    // keccak256(&quot;Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)&quot;);</span>
 17 |     | <span style='background-color: #faa;'>    bytes32 public constant PERMIT_TYPEHASH = 0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;</span>
 18 |     | <span style='background-color: #faa;'>    mapping(address =&gt; uint) public nonces;</span>
 19 |     | <span style='background-color: #eee;'></span>
 20 |     | <span style='background-color: #faa;'>    constructor() {</span>
 21 |     | <span style='background-color: #faa;'>        uint chainId;</span>
 22 |     | <span style='background-color: #eee;'>        assembly {</span>
 23 |     | <span style='background-color: #faa;'>            chainId := chainid()</span>
 24 |     | <span style='background-color: #eee;'>        }</span>
 25 |     | <span style='background-color: #faa;'>        DOMAIN_SEPARATOR = keccak256(</span>
 26 |     | <span style='background-color: #faa;'>            abi.encode(</span>
 27 |     | <span style='background-color: #faa;'>                keccak256(&#39;EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)&#39;),</span>
 28 |     | <span style='background-color: #faa;'>                keccak256(bytes(name)),</span>
 29 |     | <span style='background-color: #faa;'>                keccak256(bytes(&#39;1&#39;)),</span>
 30 |     | <span style='background-color: #faa;'>                chainId,</span>
 31 |     | <span style='background-color: #faa;'>                address(this)</span>
 32 |     | <span style='background-color: #eee;'>            )</span>
 33 |     | <span style='background-color: #eee;'>        );</span>
 34 |     | <span style='background-color: #eee;'>    }</span>
 35 |     | <span style='background-color: #eee;'></span>
 36 | *r  | <span style='background-color: #afa;'>    function _mint(address to, uint value) internal {</span>
 37 | *r  | <span style='background-color: #afa;'>        totalSupply = totalSupply + value;</span>
 38 | *r  | <span style='background-color: #afa;'>        balanceOf[to] = balanceOf[to] + value;</span>
 39 | *r  | <span style='background-color: #afa;'>        emit Transfer(address(0), to, value);</span>
 40 |     | <span style='background-color: #eee;'>    }</span>
 41 |     | <span style='background-color: #eee;'></span>
 42 |     | <span style='background-color: #faa;'>    function _burn(address from, uint value) internal {</span>
 43 |     | <span style='background-color: #faa;'>        balanceOf[from] = balanceOf[from] - value;</span>
 44 |     | <span style='background-color: #faa;'>        totalSupply = totalSupply - value;</span>
 45 |     | <span style='background-color: #faa;'>        emit Transfer(from, address(0), value);</span>
 46 |     | <span style='background-color: #eee;'>    }</span>
 47 |     | <span style='background-color: #eee;'></span>
 48 | *r  | <span style='background-color: #afa;'>    function _approve(address owner, address spender, uint value) private {</span>
 49 | *r  | <span style='background-color: #afa;'>        allowance[owner][spender] = value;</span>
 50 | *r  | <span style='background-color: #afa;'>        emit Approval(owner, spender, value);</span>
 51 |     | <span style='background-color: #eee;'>    }</span>
 52 |     | <span style='background-color: #eee;'></span>
 53 | *r  | <span style='background-color: #afa;'>    function _transfer(address from, address to, uint value) private {</span>
 54 | *r  | <span style='background-color: #afa;'>        balanceOf[from] = balanceOf[from] - value;</span>
 55 | *r  | <span style='background-color: #afa;'>        balanceOf[to] = balanceOf[to] + value;</span>
 56 | *r  | <span style='background-color: #afa;'>        emit Transfer(from, to, value);</span>
 57 |     | <span style='background-color: #eee;'>    }</span>
 58 |     | <span style='background-color: #eee;'></span>
 59 | *r  | <span style='background-color: #afa;'>    function approve(address spender, uint value) external returns (bool) {</span>
 60 | *r  | <span style='background-color: #afa;'>        _approve(msg.sender, spender, value);</span>
 61 | *r  | <span style='background-color: #afa;'>        return true;</span>
 62 |     | <span style='background-color: #eee;'>    }</span>
 63 |     | <span style='background-color: #eee;'></span>
 64 | *r  | <span style='background-color: #afa;'>    function transfer(address to, uint value) external returns (bool) {</span>
 65 | *r  | <span style='background-color: #afa;'>        _transfer(msg.sender, to, value);</span>
 66 | *r  | <span style='background-color: #afa;'>        return true;</span>
 67 |     | <span style='background-color: #eee;'>    }</span>
 68 |     | <span style='background-color: #eee;'></span>
 69 |     | <span style='background-color: #faa;'>    function transferFrom(address from, address to, uint value) external returns (bool) {</span>
 70 |     | <span style='background-color: #faa;'>        if (allowance[from][msg.sender] != ~uint(0)) {</span>
 71 |     | <span style='background-color: #faa;'>            allowance[from][msg.sender] = allowance[from][msg.sender] - value;</span>
 72 |     | <span style='background-color: #eee;'>        }</span>
 73 |     | <span style='background-color: #faa;'>        _transfer(from, to, value);</span>
 74 |     | <span style='background-color: #faa;'>        return true;</span>
 75 |     | <span style='background-color: #eee;'>    }</span>
 76 |     | <span style='background-color: #eee;'></span>
 77 |     | <span style='background-color: #faa;'>    function permit(address owner, address spender, uint value, uint deadline, uint8 v, bytes32 r, bytes32 s) external {</span>
 78 |     | <span style='background-color: #faa;'>        require(deadline &gt;= block.timestamp, &#39;UniswapV2: EXPIRED&#39;);</span>
 79 |     | <span style='background-color: #faa;'>        bytes32 digest = keccak256(</span>
 80 |     | <span style='background-color: #faa;'>            abi.encodePacked(</span>
 81 |     | <span style='background-color: #eee;'>                &#39;\x19\x01&#39;,</span>
 82 |     | <span style='background-color: #faa;'>                DOMAIN_SEPARATOR,</span>
 83 |     | <span style='background-color: #faa;'>                keccak256(abi.encode(PERMIT_TYPEHASH, owner, spender, value, nonces[owner]++, deadline))</span>
 84 |     | <span style='background-color: #eee;'>            )</span>
 85 |     | <span style='background-color: #eee;'>        );</span>
 86 |     | <span style='background-color: #faa;'>        address recoveredAddress = ecrecover(digest, v, r, s);</span>
 87 |     | <span style='background-color: #faa;'>        require(recoveredAddress != address(0) &amp;&amp; recoveredAddress == owner, &#39;UniswapV2: INVALID_SIGNATURE&#39;);</span>
 88 |     | <span style='background-color: #faa;'>        _approve(owner, spender, value);</span>
 89 |     | <span style='background-color: #eee;'>    }</span>
 90 |     | <span style='background-color: #eee;'></span>
 91 |     | <span style='background-color: #eee;'>    // For testing purposes, must be deleted after testing!</span>
 92 | *r  | <span style='background-color: #afa;'>     function mint(address account, uint amount) external {</span>
 93 | *r  | <span style='background-color: #afa;'>        _mint(account,amount);</span>
 94 |     | <span style='background-color: #eee;'>    }</span>
 95 |     | <span style='background-color: #eee;'>}</span>
 96 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/UniswapV2Factory.sol</b>
<code>
  1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
  3 |     | <span style='background-color: #eee;'></span>
  4 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2Factory.sol&#39;;</span>
  5 |     | <span style='background-color: #eee;'>import &#39;./UniswapV2Pair.sol&#39;;</span>
  6 | *   | <span style='background-color: #afa;'></span>
  7 |     | <span style='background-color: #eee;'>contract UniswapV2Factory is IUniswapV2Factory {</span>
  8 | *   | <span style='background-color: #afa;'>    address public feeTo;</span>
  9 |     | <span style='background-color: #faa;'>    address public feeToSetter;</span>
 10 |     | <span style='background-color: #eee;'></span>
 11 |     | <span style='background-color: #faa;'>    mapping(address =&gt; mapping(address =&gt; address)) public getPair;</span>
 12 |     | <span style='background-color: #faa;'>    address[] public allPairs;</span>
 13 |     | <span style='background-color: #eee;'></span>
 14 |     | <span style='background-color: #faa;'>    constructor(address _feeToSetter) {</span>
 15 |     | <span style='background-color: #faa;'>        feeToSetter = _feeToSetter;</span>
 16 |     | <span style='background-color: #eee;'>    }</span>
 17 |     | <span style='background-color: #eee;'></span>
 18 |     | <span style='background-color: #faa;'>    function allPairsLength() external view returns (uint) {</span>
 19 |     | <span style='background-color: #faa;'>        return allPairs.length;</span>
 20 |     | <span style='background-color: #eee;'>    }</span>
 21 |     | <span style='background-color: #eee;'></span>
 22 |     | <span style='background-color: #faa;'>    function createPair(address tokenA, address tokenB) external returns (address pair) {</span>
 23 |     | <span style='background-color: #faa;'>        require(tokenA != tokenB, &#39;UniswapV2: IDENTICAL_ADDRESSES&#39;);</span>
 24 |     | <span style='background-color: #faa;'>        (address token0, address token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : (tokenB, tokenA);</span>
 25 |     | <span style='background-color: #faa;'>        require(token0 != address(0), &#39;UniswapV2: ZERO_ADDRESS&#39;);</span>
 26 |     | <span style='background-color: #faa;'>        require(getPair[token0][token1] == address(0), &#39;UniswapV2: PAIR_EXISTS&#39;); // single check is sufficient</span>
 27 |     | <span style='background-color: #faa;'>        bytes memory bytecode = type(UniswapV2Pair).creationCode;</span>
 28 |     | <span style='background-color: #faa;'>        bytes32 salt = keccak256(abi.encodePacked(token0, token1));</span>
 29 |     | <span style='background-color: #eee;'>        assembly {</span>
 30 |     | <span style='background-color: #faa;'>            pair := create2(0, add(bytecode, 32), mload(bytecode), salt)</span>
 31 |     | <span style='background-color: #eee;'>        }</span>
 32 |     | <span style='background-color: #faa;'>        IUniswapV2Pair(pair).initialize(token0, token1);</span>
 33 |     | <span style='background-color: #faa;'>        getPair[token0][token1] = pair;</span>
 34 |     | <span style='background-color: #faa;'>        getPair[token1][token0] = pair; // populate mapping in the reverse direction</span>
 35 |     | <span style='background-color: #faa;'>        allPairs.push(pair);</span>
 36 |     | <span style='background-color: #faa;'>        emit PairCreated(token0, token1, pair, allPairs.length);</span>
 37 |     | <span style='background-color: #eee;'>    }</span>
 38 |     | <span style='background-color: #eee;'></span>
 39 |     | <span style='background-color: #faa;'>    function setFeeTo(address _feeTo) external {</span>
 40 |     | <span style='background-color: #faa;'>        require(msg.sender == feeToSetter, &#39;UniswapV2: FORBIDDEN&#39;);</span>
 41 |     | <span style='background-color: #faa;'>        feeTo = _feeTo;</span>
 42 |     | <span style='background-color: #eee;'>    }</span>
 43 |     | <span style='background-color: #eee;'></span>
 44 |     | <span style='background-color: #faa;'>    function setFeeToSetter(address _feeToSetter) external {</span>
 45 |     | <span style='background-color: #faa;'>        require(msg.sender == feeToSetter, &#39;UniswapV2: FORBIDDEN&#39;);</span>
 46 |     | <span style='background-color: #faa;'>        feeToSetter = _feeToSetter;</span>
 47 |     | <span style='background-color: #eee;'>    }</span>
 48 |     | <span style='background-color: #eee;'>}</span>
 49 |     | <span style='background-color: #eee;'></span>

</code>
<br />

<b>/home/v_lnko/WebstormProjects/Job/Web3/uniswapv2-echidna/v2-periphery/contracts/test/UniswapV2Pair.sol</b>
<code>
   1 |     | <span style='background-color: #eee;'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span style='background-color: #eee;'>pragma solidity 0.8.13;</span>
   3 |     | <span style='background-color: #eee;'></span>
   4 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2Pair.sol&#39;;</span>
   5 |     | <span style='background-color: #eee;'>import &#39;./UniswapV2ERC20.sol&#39;;</span>
   6 |     | <span style='background-color: #eee;'>import &#39;./Math.sol&#39;;</span>
   7 |     | <span style='background-color: #eee;'>import &#39;./UQ112x112.sol&#39;;</span>
   8 |     | <span style='background-color: #eee;'>import &#39;./IERC20.sol&#39;;</span>
   9 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2Factory.sol&#39;;</span>
  10 |     | <span style='background-color: #eee;'>import &#39;./IUniswapV2Callee.sol&#39;;</span>
  11 | *r  | <span style='background-color: #afa;'></span>
  12 |     | <span style='background-color: #eee;'>contract UniswapV2Pair is IUniswapV2Pair, UniswapV2ERC20 {</span>
  13 |     | <span style='background-color: #eee;'>    using UQ112x112 for uint224;</span>
  14 |     | <span style='background-color: #eee;'></span>
  15 | *   | <span style='background-color: #afa;'>    uint public constant MINIMUM_LIQUIDITY = 10**3;</span>
  16 | *   | <span style='background-color: #afa;'>    bytes4 private constant SELECTOR = bytes4(keccak256(bytes(&#39;transfer(address,uint256)&#39;)));</span>
  17 |     | <span style='background-color: #eee;'></span>
  18 |     | <span style='background-color: #faa;'>    address public factory;</span>
  19 |     | <span style='background-color: #faa;'>    address public token0;</span>
  20 |     | <span style='background-color: #faa;'>    address public token1;</span>
  21 |     | <span style='background-color: #eee;'></span>
  22 |     | <span style='background-color: #eee;'>    uint112 private reserve0;           // uses single storage slot, accessible via getReserves</span>
  23 |     | <span style='background-color: #eee;'>    uint112 private reserve1;           // uses single storage slot, accessible via getReserves</span>
  24 |     | <span style='background-color: #eee;'>    uint32  private blockTimestampLast; // uses single storage slot, accessible via getReserves</span>
  25 |     | <span style='background-color: #eee;'></span>
  26 |     | <span style='background-color: #faa;'>    uint public price0CumulativeLast;</span>
  27 |     | <span style='background-color: #faa;'>    uint public price1CumulativeLast;</span>
  28 |     | <span style='background-color: #faa;'>    uint public kLast; // reserve0 * reserve1, as of immediately after the most recent liquidity event</span>
  29 |     | <span style='background-color: #eee;'></span>
  30 |     | <span style='background-color: #faa;'>    uint private unlocked = 1;</span>
  31 |     | <span style='background-color: #eee;'>    modifier lock() {</span>
  32 | *   | <span style='background-color: #afa;'>        require(unlocked == 1, &#39;UniswapV2: LOCKED&#39;);</span>
  33 | *   | <span style='background-color: #afa;'>        unlocked = 0;</span>
  34 |     | <span style='background-color: #eee;'>        _;</span>
  35 | *   | <span style='background-color: #afa;'>        unlocked = 1;</span>
  36 |     | <span style='background-color: #eee;'>    }</span>
  37 |     | <span style='background-color: #eee;'></span>
  38 | *r  | <span style='background-color: #afa;'>    function getReserves() public view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast) {</span>
  39 | *r  | <span style='background-color: #afa;'>        _reserve0 = reserve0;</span>
  40 | *r  | <span style='background-color: #afa;'>        _reserve1 = reserve1;</span>
  41 | *r  | <span style='background-color: #afa;'>        _blockTimestampLast = blockTimestampLast;</span>
  42 |     | <span style='background-color: #eee;'>    }</span>
  43 |     | <span style='background-color: #eee;'></span>
  44 | *   | <span style='background-color: #afa;'>    function _safeTransfer(address token, address to, uint value) private {</span>
  45 | *   | <span style='background-color: #afa;'>        (bool success, bytes memory data) = token.call(abi.encodeWithSelector(SELECTOR, to, value));</span>
  46 | *   | <span style='background-color: #afa;'>        require(success &amp;&amp; (data.length == 0 || abi.decode(data, (bool))), &#39;UniswapV2: TRANSFER_FAILED&#39;);</span>
  47 |     | <span style='background-color: #eee;'>    }</span>
  48 |     | <span style='background-color: #eee;'></span>
  49 |     | <span style='background-color: #faa;'>    constructor() {</span>
  50 |     | <span style='background-color: #faa;'>        factory = msg.sender;</span>
  51 |     | <span style='background-color: #eee;'>    }</span>
  52 |     | <span style='background-color: #eee;'></span>
  53 |     | <span style='background-color: #eee;'>    // called once by the factory at time of deployment</span>
  54 |     | <span style='background-color: #faa;'>    function initialize(address _token0, address _token1) external {</span>
  55 |     | <span style='background-color: #faa;'>        require(msg.sender == factory, &#39;UniswapV2: FORBIDDEN&#39;); // sufficient check</span>
  56 |     | <span style='background-color: #faa;'>        token0 = _token0;</span>
  57 |     | <span style='background-color: #faa;'>        token1 = _token1;</span>
  58 |     | <span style='background-color: #eee;'>    }</span>
  59 |     | <span style='background-color: #eee;'></span>
  60 |     | <span style='background-color: #eee;'>    // update reserves and, on the first call per block, price accumulators</span>
  61 | *   | <span style='background-color: #afa;'>    function _update(uint balance0, uint balance1, uint112 _reserve0, uint112 _reserve1) private {</span>
  62 | *   | <span style='background-color: #afa;'>        require(balance0 &lt;= ~uint112(0) &amp;&amp; balance1 &lt;= ~uint112(0), &#39;UniswapV2: OVERFLOW&#39;);</span>
  63 | *   | <span style='background-color: #afa;'>        uint32 blockTimestamp = uint32(block.timestamp % 2**32);</span>
  64 | *   | <span style='background-color: #afa;'>        uint32 timeElapsed = blockTimestamp - blockTimestampLast; // overflow is desired</span>
  65 | *   | <span style='background-color: #afa;'>        if (timeElapsed &gt; 0 &amp;&amp; _reserve0 != 0 &amp;&amp; _reserve1 != 0) {</span>
  66 |     | <span style='background-color: #eee;'>            // * never overflows, and + overflow is desired</span>
  67 | *   | <span style='background-color: #afa;'>            price0CumulativeLast += uint(UQ112x112.encode(_reserve1).uqdiv(_reserve0)) * timeElapsed;</span>
  68 | *   | <span style='background-color: #afa;'>            price1CumulativeLast += uint(UQ112x112.encode(_reserve0).uqdiv(_reserve1)) * timeElapsed;</span>
  69 |     | <span style='background-color: #eee;'>        }</span>
  70 | *   | <span style='background-color: #afa;'>        reserve0 = uint112(balance0);</span>
  71 | *   | <span style='background-color: #afa;'>        reserve1 = uint112(balance1);</span>
  72 | *   | <span style='background-color: #afa;'>        blockTimestampLast = blockTimestamp;</span>
  73 | *   | <span style='background-color: #afa;'>        emit Sync(reserve0, reserve1);</span>
  74 |     | <span style='background-color: #eee;'>    }</span>
  75 |     | <span style='background-color: #eee;'></span>
  76 |     | <span style='background-color: #eee;'>    // if fee is on, mint liquidity equivalent to 1/6th of the growth in sqrt(k)</span>
  77 | *   | <span style='background-color: #afa;'>    function _mintFee(uint112 _reserve0, uint112 _reserve1) private returns (bool feeOn) {</span>
  78 | *   | <span style='background-color: #afa;'>        address feeTo = IUniswapV2Factory(factory).feeTo();</span>
  79 | *   | <span style='background-color: #afa;'>        feeOn = feeTo != address(0);</span>
  80 | *   | <span style='background-color: #afa;'>        uint _kLast = kLast; // gas savings</span>
  81 | *   | <span style='background-color: #afa;'>        if (feeOn) {</span>
  82 |     | <span style='background-color: #faa;'>            if (_kLast != 0) {</span>
  83 |     | <span style='background-color: #faa;'>                uint rootK = Math.sqrt(uint(_reserve0) * _reserve1);</span>
  84 |     | <span style='background-color: #faa;'>                uint rootKLast = Math.sqrt(_kLast);</span>
  85 |     | <span style='background-color: #faa;'>                if (rootK &gt; rootKLast) {</span>
  86 |     | <span style='background-color: #faa;'>                    uint numerator = (totalSupply * rootK) - rootKLast;</span>
  87 |     | <span style='background-color: #faa;'>                    uint denominator = (rootK * 5) + rootKLast;</span>
  88 |     | <span style='background-color: #faa;'>                    uint liquidity = numerator / denominator;</span>
  89 |     | <span style='background-color: #faa;'>                    if (liquidity &gt; 0) _mint(feeTo, liquidity);</span>
  90 |     | <span style='background-color: #eee;'>                }</span>
  91 |     | <span style='background-color: #eee;'>            }</span>
  92 | *   | <span style='background-color: #afa;'>        } else if (_kLast != 0) {</span>
  93 |     | <span style='background-color: #faa;'>            kLast = 0;</span>
  94 |     | <span style='background-color: #eee;'>        }</span>
  95 |     | <span style='background-color: #eee;'>    }</span>
  96 |     | <span style='background-color: #eee;'></span>
  97 |     | <span style='background-color: #eee;'>    // this low-level function should be called from a contract which performs important safety checks</span>
  98 | *   | <span style='background-color: #afa;'>    function mint(address to) external lock returns (uint liquidity) {</span>
  99 | *   | <span style='background-color: #afa;'>        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings</span>
 100 | *   | <span style='background-color: #afa;'>        uint balance0 = IERC20(token0).balanceOf(address(this));</span>
 101 | *   | <span style='background-color: #afa;'>        uint balance1 = IERC20(token1).balanceOf(address(this));</span>
 102 | *   | <span style='background-color: #afa;'>        uint amount0 = balance0 - _reserve0;</span>
 103 | *   | <span style='background-color: #afa;'>        uint amount1 = balance1 - _reserve1;</span>
 104 |     | <span style='background-color: #eee;'></span>
 105 | *   | <span style='background-color: #afa;'>        bool feeOn = _mintFee(_reserve0, _reserve1);</span>
 106 | *   | <span style='background-color: #afa;'>        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee</span>
 107 | *   | <span style='background-color: #afa;'>        if (_totalSupply == 0) {</span>
 108 | *   | <span style='background-color: #afa;'>            liquidity = Math.sqrt(amount0 * amount1)-(MINIMUM_LIQUIDITY);</span>
 109 | *   | <span style='background-color: #afa;'>           _mint(address(0), MINIMUM_LIQUIDITY); // permanently lock the first MINIMUM_LIQUIDITY tokens</span>
 110 |     | <span style='background-color: #eee;'>        } else {</span>
 111 |     | <span style='background-color: #faa;'>            liquidity = Math.min(amount0*(_totalSupply) / _reserve0, amount1*(_totalSupply) / _reserve1);</span>
 112 |     | <span style='background-color: #eee;'>        }</span>
 113 | *   | <span style='background-color: #afa;'>        require(liquidity &gt; 0, &#39;UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED&#39;);</span>
 114 | *   | <span style='background-color: #afa;'>        _mint(to, liquidity);</span>
 115 |     | <span style='background-color: #eee;'></span>
 116 | *   | <span style='background-color: #afa;'>        _update(balance0, balance1, _reserve0, _reserve1);</span>
 117 | *   | <span style='background-color: #afa;'>        if (feeOn) kLast = uint(reserve0)*(reserve1); // reserve0 and reserve1 are up-to-date</span>
 118 | *   | <span style='background-color: #afa;'>        emit Mint(msg.sender, amount0, amount1);</span>
 119 |     | <span style='background-color: #eee;'>    }</span>
 120 |     | <span style='background-color: #eee;'></span>
 121 |     | <span style='background-color: #eee;'>    // this low-level function should be called from a contract which performs important safety checks</span>
 122 |     | <span style='background-color: #faa;'>    function burn(address to) external lock returns (uint amount0, uint amount1) {</span>
 123 |     | <span style='background-color: #faa;'>        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings</span>
 124 |     | <span style='background-color: #faa;'>        address _token0 = token0;                                // gas savings</span>
 125 |     | <span style='background-color: #faa;'>        address _token1 = token1;                                // gas savings</span>
 126 |     | <span style='background-color: #faa;'>        uint balance0 = IERC20(_token0).balanceOf(address(this));</span>
 127 |     | <span style='background-color: #faa;'>        uint balance1 = IERC20(_token1).balanceOf(address(this));</span>
 128 |     | <span style='background-color: #faa;'>        uint liquidity = balanceOf[address(this)];</span>
 129 |     | <span style='background-color: #eee;'></span>
 130 |     | <span style='background-color: #faa;'>        bool feeOn = _mintFee(_reserve0, _reserve1);</span>
 131 |     | <span style='background-color: #faa;'>        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee</span>
 132 |     | <span style='background-color: #faa;'>        amount0 = liquidity * (balance0) / _totalSupply; // using balances ensures pro-rata distribution</span>
 133 |     | <span style='background-color: #faa;'>        amount1 = liquidity * (balance1) / _totalSupply; // using balances ensures pro-rata distribution</span>
 134 |     | <span style='background-color: #faa;'>        require(amount0 &gt; 0 &amp;&amp; amount1 &gt; 0, &#39;UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED&#39;);</span>
 135 |     | <span style='background-color: #faa;'>        _burn(address(this), liquidity);</span>
 136 |     | <span style='background-color: #faa;'>        _safeTransfer(_token0, to, amount0);</span>
 137 |     | <span style='background-color: #faa;'>        _safeTransfer(_token1, to, amount1);</span>
 138 |     | <span style='background-color: #faa;'>        balance0 = IERC20(_token0).balanceOf(address(this));</span>
 139 |     | <span style='background-color: #faa;'>        balance1 = IERC20(_token1).balanceOf(address(this));</span>
 140 |     | <span style='background-color: #eee;'></span>
 141 |     | <span style='background-color: #faa;'>        _update(balance0, balance1, _reserve0, _reserve1);</span>
 142 |     | <span style='background-color: #faa;'>        if (feeOn) kLast = uint(reserve0) * (reserve1); // reserve0 and reserve1 are up-to-date</span>
 143 |     | <span style='background-color: #faa;'>        emit Burn(msg.sender, amount0, amount1, to);</span>
 144 |     | <span style='background-color: #eee;'>    }</span>
 145 |     | <span style='background-color: #eee;'></span>
 146 |     | <span style='background-color: #eee;'>    // this low-level function should be called from a contract which performs important safety checks</span>
 147 | *   | <span style='background-color: #afa;'>    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external lock {</span>
 148 | *   | <span style='background-color: #afa;'>        require(amount0Out &gt; 0 || amount1Out &gt; 0, &#39;UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span>
 149 | *   | <span style='background-color: #afa;'>        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings</span>
 150 | *   | <span style='background-color: #afa;'>        require(amount0Out &lt; _reserve0 &amp;&amp; amount1Out &lt; _reserve1, &#39;UniswapV2: INSUFFICIENT_LIQUIDITY&#39;);</span>
 151 |     | <span style='background-color: #eee;'></span>
 152 | *   | <span style='background-color: #afa;'>        uint balance0;</span>
 153 | *   | <span style='background-color: #afa;'>        uint balance1;</span>
 154 | *   | <span style='background-color: #afa;'>        { // scope for _token{0,1}, avoids stack too deep errors</span>
 155 | *   | <span style='background-color: #afa;'>        address _token0 = token0;</span>
 156 | *   | <span style='background-color: #afa;'>        address _token1 = token1;</span>
 157 | *   | <span style='background-color: #afa;'>        require(to != _token0 &amp;&amp; to != _token1, &#39;UniswapV2: INVALID_TO&#39;);</span>
 158 | *   | <span style='background-color: #afa;'>        if (amount0Out &gt; 0) _safeTransfer(_token0, to, amount0Out); // optimistically transfer tokens</span>
 159 | *   | <span style='background-color: #afa;'>        if (amount1Out &gt; 0) _safeTransfer(_token1, to, amount1Out); // optimistically transfer tokens</span>
 160 | *   | <span style='background-color: #afa;'>        if (data.length &gt; 0) IUniswapV2Callee(to).uniswapV2Call(msg.sender, amount0Out, amount1Out, data);</span>
 161 | *   | <span style='background-color: #afa;'>        balance0 = IERC20(_token0).balanceOf(address(this));</span>
 162 | *   | <span style='background-color: #afa;'>        balance1 = IERC20(_token1).balanceOf(address(this));</span>
 163 |     | <span style='background-color: #eee;'>        }</span>
 164 | *   | <span style='background-color: #afa;'>        uint amount0In = balance0 &gt; _reserve0 - amount0Out ? balance0 - (_reserve0 - amount0Out) : 0;</span>
 165 | *   | <span style='background-color: #afa;'>        uint amount1In = balance1 &gt; _reserve1 - amount1Out ? balance1 - (_reserve1 - amount1Out) : 0;</span>
 166 | *   | <span style='background-color: #afa;'>        require(amount0In &gt; 0 || amount1In &gt; 0, &#39;UniswapV2: INSUFFICIENT_INPUT_AMOUNT&#39;);</span>
 167 |     | <span style='background-color: #faa;'>        { // scope for reserve{0,1}Adjusted, avoids stack too deep errors</span>
 168 |     | <span style='background-color: #faa;'>        uint balance0Adjusted = (balance0 * (1000))-(amount0In*(3));</span>
 169 |     | <span style='background-color: #faa;'>        uint balance1Adjusted = (balance1 * (1000))-(amount1In*(3));</span>
 170 |     | <span style='background-color: #faa;'>        require(balance0Adjusted*(balance1Adjusted) &gt;= uint(_reserve0)*(_reserve1)*(1000**2), &#39;UniswapV2: K&#39;);</span>
 171 |     | <span style='background-color: #eee;'>        }</span>
 172 |     | <span style='background-color: #faa;'>        _update(balance0, balance1, _reserve0, _reserve1);</span>
 173 |     | <span style='background-color: #faa;'>        emit Swap(msg.sender, amount0In, amount1In, amount0Out, amount1Out, to);</span>
 174 |     | <span style='background-color: #eee;'>    }</span>
 175 |     | <span style='background-color: #eee;'></span>
 176 |     | <span style='background-color: #eee;'>    // force balances to match reserves</span>
 177 |     | <span style='background-color: #faa;'>    function skim(address to) external lock {</span>
 178 |     | <span style='background-color: #faa;'>        address _token0 = token0; // gas savings</span>
 179 |     | <span style='background-color: #faa;'>        address _token1 = token1; // gas savings</span>
 180 |     | <span style='background-color: #faa;'>        _safeTransfer(_token0, to, IERC20(_token0).balanceOf(address(this)) - reserve0);</span>
 181 |     | <span style='background-color: #faa;'>        _safeTransfer(_token1, to, IERC20(_token1).balanceOf(address(this)) - reserve1);</span>
 182 |     | <span style='background-color: #eee;'>    }</span>
 183 |     | <span style='background-color: #eee;'></span>
 184 |     | <span style='background-color: #eee;'>    // force reserves to match balances</span>
 185 | *   | <span style='background-color: #afa;'>    function sync() external lock {</span>
 186 | *   | <span style='background-color: #afa;'>        _update(IERC20(token0).balanceOf(address(this)), IERC20(token1).balanceOf(address(this)), reserve0, reserve1);</span>
 187 |     | <span style='background-color: #eee;'>    }</span>
 188 |     | <span style='background-color: #eee;'>}</span>
 189 |     | <span style='background-color: #eee;'></span>

</code>
<br />

